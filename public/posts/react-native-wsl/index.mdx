---
title: "WSL ã‹ã‚‰ React Native ã‚’ Android Studio ã§å‹•ã‹ã™"
date: 2021-03-19T12:00:00+09:00
lastmod: 2021-05-02T12:00:00+09:00
categories: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ä¸€èˆ¬]
tags: [React, ã‚¢ãƒ—ãƒªé–‹ç™º, ãƒ„ãƒ¼ãƒ«]
draft: false
---

React Native ã¨ã„ã†ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ãƒ„ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚

ãã“ã§ä½œã£ãŸã‚¢ãƒ—ãƒªã‚’ Android Studio ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§å‹•ã‹ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

React Native ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ WSL2(Windows Subsystem for Linux 2) ã®å†…éƒ¨ã«ç½®ãã“ã¨ã‚‚ã§ãã‚‹ã®ã§ã™ãŒã€

<!--more-->

ã‚„ã‚Šæ–¹ã‚’èª¿ã¹ã¦ã‚‚æƒ…å ±ãŒå¤ã‹ã£ãŸã‚Šæ—¥æœ¬èªã®è¨˜äº‹ãŒå°‘ãªã‹ã£ãŸã‚Šã†ã¾ãã„ã£ã¦ãªã‹ã£ãŸã‚Šã§çµæ§‹è‹¦åŠ´ã—ãŸã®ã§ã€ã“ã“ã«ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚

<br/>

å‚è€ƒï¼š[React Native no Emulador Android Studio com WSL2 Â· GitHub](https://gist.github.com/georgealan/353a548814fe9b82a3a502926c7a42c6#observa%C3%A7%C3%B5es)

åœ°çƒã®åå¯¾å´ã®äººã®æŠ•ç¨¿ãŒå¤§ã„ã«å½¹ã«ç«‹ã¡ã¾ã—ãŸã€‚ç¬‘

ç§ã®å‹•ä½œç’°å¢ƒã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚

- Windows 10 Home ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 2004
- Android Studio Version 4.1.2
- WSL 2
- Ubuntu 20.04.1 LTS

<br/>

## [Windows] ã„ã‚ã„ã‚è¨­å®š

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é™¤å¤–è¨­å®š

Windows ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ã‚¦ã‚¤ãƒ«ã‚¹ã¨è„…å¨ã®é˜²æ­¢ > ã‚¦ã‚¤ãƒ«ã‚¹ã¨è„…å¨ã®é˜²æ­¢ã®è¨­å®š > é™¤å¤–ã‹ã‚‰

Ubuntu ã®ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆ`C:\Users\<username>\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_...`ï¼‰ã‚’é™¤å¤–ã—ã¾ã™ã€‚

ç§ã®PCã§ã¯ã“ã®é …ç›®ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã‹ã£ãŸã®ã§ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚¨ãƒ‡ã‚£ã‚¿ã‚’ã„ã˜ã£ã¦è¡¨ç¤ºã•ã›ã¦é™¤å¤–ã—ã¾ã—ãŸã€‚

å‚è€ƒï¼š[Windowsã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã§ã‚¦ã‚¤ãƒ«ã‚¹ã¨è„…å¨ã®é˜²æ­¢ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€‚ - ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£](https://answers.microsoft.com/ja-jp/protect/forum/protect_defender-protect_start-windows_10/windows%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA/62dba1b7-e42d-486c-9b2d-ead4126c0b63)

ã“ã‚Œã‚’ã—ãªã„ã¨ WSL ã§èµ·å‹•ã—ãŸ Metro ã¨ Windows å´ã® Android Studio ãŒç¹‹ãŒã‚‰ãªã„ã‚ˆã†ã§ã™ã€‚

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãªã©

Windows ã« [Android Studio](https://developer.android.com/studio) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

Android Studio ã®è¨­å®šã¯ã€åŸºæœ¬çš„ã«[å…¬å¼](https://reactnative.dev/docs/environment-setup)ã® Windows + Android ã®èª¬æ˜ã«æ²¿ã£ã¦ã„ãã¾ã™ã€‚

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå¾Œã« Configure > SDK Manager ã‹ã‚‰é¸æŠã—ã¦è¿½åŠ ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã®ã§ã€

`Android SDK Platform 29`ã¨

`Intel x86 Atom_64 System Image`ã¾ãŸã¯`Google APIs Intel x86 Atom System Image`ã‚’ãƒã‚§ãƒƒã‚¯ã€‚

ã•ã‚‰ã« SDK Tools ã‚¿ãƒ–ã«ç§»ã£ã¦`Android Sdk Build-Tools` > `29.0.2`ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

<br/>

ãã®å¾Œã€Android SDK ã®ãƒ‘ã‚¹ã‚’é€šã—ã¾ã™ã€‚

ç’°å¢ƒå¤‰æ•°ã«`C:\Users\<username>\AppData\Local\Android\Sdk\platform-tools`ã‚’è¿½åŠ ã—ã¾ã™ã€‚

<br/>

Android Studio ã§ã¯ Configure > AVD Manager ã‹ã‚‰ Q API Level 29 image ã®ä»®æƒ³ãƒ‡ãƒã‚¤ã‚¹ã‚’ä½œæˆã—ã¦ãŠãã¾ã™ã€‚

{{< relpos windows10home-docker >}}

<br/>

## [WSL] ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãªã©

åŸºæœ¬çš„ã«ã¯[ã“ã®æŠ•ç¨¿](https://gist.github.com/georgealan/353a548814fe9b82a3a502926c7a42c6#passo-2%C2%BA)ã®é€šã‚Šã§ã™ãŒã€è‹¥å¹²å¤ã„éƒ¨åˆ†ãŒã‚ã‚‹ã®ã§æ”¹ã‚ã¦æ›¸ãã¾ã™ã€‚

```bash {linenos=false}
# ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
$ cd

# unzip ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
~ $ sudo apt install unzip

# Linux ç”¨ command line tools ã‚’å…¥æ‰‹ã™ã‚‹ã€‚
# æœ€æ–°ç‰ˆã¯ https://developer.android.com/studio#command-tools ã‹ã‚‰ç¢ºèªã§ãã‚‹ã€‚
~ $ wget https://dl.google.com/android/repository/commandlinetools-linux-6858069_latest.zip

# Android ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã¦è§£å‡ã™ã‚‹
~ $ unzip commandlinetools-linux-6858069_latest.zip -d Android

# zip ã‚’æ¶ˆã™
~ $ rm -rf commandlinetools-linux-6858069_latest.zip

# JDK ã¨ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# 9 ä»¥é™ã ã¨ tools.jar ãŒãªã„ã¨ã‹ãªã‚“ã¨ã‹ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã‚‰ã—ã„
~ $ sudo apt install -y lib32z1 openjdk-8-jdk

# Java ç¢ºèª
~ $ java -version

~ $ cd Android
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆå¤‰æ›´
# ã“ã†ã—ãªã„ã¨ ./sdkmanager --install ã§ã‚³ã‚±ã‚‹
# ã‚‚ã¨ã‚‚ã¨ã¯ cmdline-tools/ ã®ä¸­ã«ã„ã‚ã„ã‚ã‚ã‚‹ãŒã€
# cmdline-tools/latest/ ã®ä¸­ã«ç§»å‹•ã™ã‚‹
~/Android $ mv cmdline-tools latest
~/Android $ mkdir cmdline-tools
~/Android $ mv latest cmdline-tools

~/Android $ cd cmdline-tools/latest/bin

# ã„ã‚ã„ã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
# React Native ã®æ¨å¥¨ãŒ 29 ã ã£ãŸã®ã§ 29 ã‚’å…¥ã‚Œã‚‹
~/A/c/l/bin $ ./sdkmanager --install "platform-tools" "platforms;android-29" "build-tools;29.0.2"

# ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
~/A/c/l/bin $ sdkmanager --update

# Gradle ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
~/A/c/l/bin $ sudo apt install gradle

# Gradle ç¢ºèª
~/A/c/l/bin $ gradle -v
```

ã“ã“ã‹ã‚‰ã¯å…ƒæŠ•ç¨¿ã«æ›¸ã„ã¦ã„ãªã‹ã£ãŸã“ã¨ã§ã™ã€‚

```bash {linenos=false}
~/A/c/l/bin $ cd ~/Android

# sdkmanager ã«ã‚ˆã£ã¦ãƒ•ã‚©ãƒ«ãƒ€ãŒã§ãã¦ã„ã‚‹
~/Android $ ls
build-tools  cmdline-tools  emulator  licenses  patcher  platform-tools  platform-tools-2  platforms  tools

~/Android $ cd platform-tools

# platform-tools ã®ä¸­ã« adb ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚‹
~/A/platform-tools $ ls adb
adb

# adb ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹
~/A/platform-tools $ mv adb adb2

# ä»£ã‚ã‚Šã« Windows å´ã® adb ã‚’ä½¿ã†ã‚ˆã†ã«ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’è²¼ã‚‹
~/A/platform-tools $ ln -s /mnt/c/Users/<username>/AppData/Local/Android/Sdk/platform-tools/adb.exe adb
```

React Native ãŒ`~/Android/platform-tools/adb`ã‚’ä½¿ã†ã¿ãŸã„ã§ã€

ã“ã®è¨­å®šã‚’ã—ãªã„ã¨`sdkmanager`ã«ã‚ˆã£ã¦ä½œã‚‰ã‚ŒãŸ`adb`ã‚’ä½¿ã£ã¦ã—ã¾ã„ã€`react-native run-android`ã—ãŸã¨ãã«ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

Windows å´ã®`adb.exe`ã¯ Android Studio ã®ã‚‚ã®ãªã®ã§ã€ã“ã‚Œã§ã¤ãªã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

<br/>

ã¤ã¥ã„ã¦ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚

ã“ã‚Œã¯ã€ä¾‹ãˆã° fish ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ bash ã®`.bashrc`ã¨ fish ã®`.config/fish/config.fish`ã®ä¸¡æ–¹ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```bashrc {name="~/.bashrc", id=0}
export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
export PATH=$PATH:$JAVA_HOME/bin

export ANDROID_HOME=$HOME/Android
export PATH=$PATH:$ANDROID_HOME/emulator
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/tools/bin
export PATH=$PATH:$ANDROID_HOME/platform-tools
```

```bashrc {name="~/.config/fish/config.fish", id=1}
set JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64
set ANDROID_HOME $HOME/Android
set PATH $PATH $JAVA_HOME/bin $ANDROID_HOME/emulator $ANDROID_HOME/tools $ANDROID_HOME/tools/bin $ANDROID_HOME/platform-tools
```

<br/>

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Ÿè¡Œ

ã¾ãšã€Android Studio ã‹ã‚‰ AVD ã‚’èµ·å‹•ã—ã¾ã™ã€‚

AVD Manager ã§ä»®æƒ³ãƒ‡ãƒã‚¤ã‚¹ã®ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ã•ãã»ã©ä½œæˆã—ãŸã‚‚ã®ã‚’ç·‘è‰²ã®ä¸‰è§’ãƒœã‚¿ãƒ³â–¶ã§èµ·å‹•ã—ã¾ã™ã€‚

<br/>

æ¬¡ã« PowerShell ã‚’ç«‹ã¡ä¸Šã’ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¡ã¾ã™ã€‚

```powershell {linenos=false}
adb kill-server
adb -a nodaemon server start
```

<br/>

æ–°ãŸã« WSL Ubuntu ã‚’é–‹ãã€ã¾ã  React Native ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ãªã„å ´åˆã¯ä½œæˆã—ã¾ã™ã€‚

```bash {linenos=false}
npx react-native init AwesomeProject
cd AwesomeProject
```

ãã—ã¦ Metro ã‚’ç«‹ã¡ä¸Šã’ã¾ã™ã€‚

```bash {linenos=false}
npx react-native start --host 127.0.0.1
```

æ–°ãŸã« WSL Ubuntu ã‚’é–‹ãã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã§æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¡ã¾ã™ã€‚

```bash {linenos=false}
npx react-native run-android --variant=debug --deviceId emulator-5554
```

ã“ã‚Œã§ã†ã¾ãã„ã£ã¦ã„ã‚Œã°ã€Android Studio ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®è¡¨ç¤ºãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã¯ãšã§ã™ã€‚

{{< img src=result alt=å®Œæˆ >}}

ã“ã‚Œã§ fish ã‚’ä½¿ã„ãªãŒã‚‰é–‹ç™ºã§ãã‚‹ï¼ã†ã‚Œã—ã„ï¼

<br/>

2å›ç›®ä»¥é™ã¯ Android Studio ã® AVD èµ·å‹•

â†’ PowerShell ã§`adb`ã‚³ãƒãƒ³ãƒ‰

â†’ WSL ã§ Metro ç«‹ã¡ä¸Šã’

â†’ WSL ã§ run-android ã¾ãŸã¯ Android Studio ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ã‚¢ãƒ—ãƒªå†èµ·å‹•

ã“ã‚Œã ã‘ã§ OKï¼

---

ã“ã®è¨˜äº‹ãŒãŠå½¹ã«ç«‹ã¦ã‚Œã°å¹¸ã„ã§ã™ã€‚

ã§ã¯ã¾ãŸğŸ‘‹
