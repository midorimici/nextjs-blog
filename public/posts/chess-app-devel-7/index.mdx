---
title: 'ãƒã‚§ã‚¹ã‚¢ãƒ—ãƒªé–‹ç™º(7) Pillow ã§é§’ã‚’è¡¨ç¤º'
date: 2020-03-22T12:00:00+09:00
lastmod: 2020-12-16T12:00:00+09:00
categories: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, ãƒã‚§ã‚¹ã‚¢ãƒ—ãƒªé–‹ç™º]
tags: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, Python, OpenGL, ã‚¢ãƒ—ãƒªé–‹ç™º, ãƒã‚§ã‚¹]
draft: false
---

Python ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§å‹•ã‹ã™ãƒ•ã‚§ã‚¢ãƒªãƒ¼ãƒã‚§ã‚¹ã‚¢ãƒ—ãƒªé–‹ç™ºã€é€£è¼‰ç¬¬ 7 å›ã§ã™ã€‚

<pstlk label="å‰å›" to="chess-app-devel-6" />ã§é§’ã‚’ä¹—ã›ã‚‹ãŸã‚ã®ç›¤é¢ãŒæº–å‚™ã§ãã¾ã—ãŸã€‚

ä»Šå›ã¯ã€ç›¤é¢ã«é…ç½®ã™ã‚‹é§’ã®ç”»åƒã‚’æº–å‚™ã—ã¦èª­ã¿è¾¼ã‚“ã§ç”»é¢ã«è¡¨ç¤ºã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

<!--more-->

<br/>

## ç”»åƒã‚’æº–å‚™

ã“ã¡ã‚‰ã®ç”»åƒã‚’ä½¿ã‚ã›ã¦ã„ãŸã ã„ã¦ã„ã¾ã™ã€‚

â†’ [Clker-Free-Vector-Images](https://pixabay.com/ja/users/Clker-Free-Vector-Images-3736/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=26774)ã«ã‚ˆã‚‹[Pixabay](https://pixabay.com/ja/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=26774)ã‹ã‚‰ã®[ç”»åƒ](https://pixabay.com/ja/vectors/%E3%83%81%E3%82%A7%E3%82%B9-%E4%BD%9C%E5%93%81-%E8%A8%AD%E5%AE%9A-%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AB-26774/)

ã“ã¡ã‚‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ç”»åƒç·¨é›†ã‚½ãƒ•ãƒˆï¼ˆç§ã¯ [GIMP](https://www.gimp.org/) ã‚’ä½¿ã£ã¦ã„ã¾ã™ï¼‰ã§å„ 100x100 ã®ã‚µã‚¤ã‚ºã®ã‚‚ã®ã‚’ç™½é»’åˆã‚ã›ã¦ 12 æšä½œã‚Šã¾ã—ãŸã€‚

ç”»åƒã®åå‰ã¯ã€ä¾‹ãˆã°ç™½ã®ã‚¯ã‚¤ãƒ¼ãƒ³ãªã‚‰ WQ.pngã€é»’ã®ãƒŠã‚¤ãƒˆãªã‚‰ BN.png ã¨ã„ã†ã‚ˆã†ã«ã€

è‰²ã¨æ£‹è­œã«ãŠã‘ã‚‹é§’ã‚’è¡¨ã™è¨˜å·ã‚’ã‚‚ã¨ã«ã—ã¦ã„ã¾ã™ã€‚

å½“åˆã“ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ¡ã‚¤ãƒ³ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨åŒä¸€éšå±¤ã«æ–°ãŸãªãƒ•ã‚©ãƒ«ãƒ€ã‚’ã¤ãã£ã¦ãã®ä¸‹ã«é…ç½®ã—ã¦ã„ã¾ã—ãŸã€‚

```
â”¬ chess
â”œâ”€ main.py
â”œâ”€ pieces.py
â”œâ”¬ img
â”‚â”œâ”€ BB.png
â”‚â”œâ”€ ...
â”‚â””â”€ WR.png
```

ä»Šã¯ã‚³ãƒ¼ãƒ‰ãŒå¢—ãˆãŸã®ã§ã€ Python ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¾ã¨ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚Šã€æ¬¡ã®ã‚ˆã†ãªæ§‹æˆã«ãªã£ã¦ã„ã¾ã™ã€‚

```
â”¬ chess
â”œâ”¬ codes
â”‚â”œâ”€ main.py
â”‚â””â”€ pieces.py
â”œâ”¬ img
â”‚â”œâ”¬ B
â”‚â”‚â”œâ”€ BB.png
â”‚â”‚â”œâ”€ ...
â”‚â”‚â””â”€ BR.png
â”‚â”œâ”¬ W
â”‚â”‚â”œâ”€ WB.png
...
```

ã“ã“ã§ã¯å¾Œè€…ã®æ§‹æˆã«åŸºã¥ã„ã¦ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚

<br/>

## ç”»åƒã®èª­ã¿è¾¼ã¿ã¨è¨­å®š

<p>
{{% tooltip %}}[Pillow](https://pillow.readthedocs.io/en/stable/)((Python ã®ç”»åƒå‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª{{% /tooltip %}}
ã‚’ä½¿ã£ã¦ç”»åƒã‚’å‡¦ç†ã—ã¾ã™ã€‚
</p>

pip ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
pip install Pillow
```

### ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®è¨­å®š

ã¨ã“ã‚ã§ã€ç”»åƒã®è¡¨ç¤ºã«ã¯[ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒãƒƒãƒ”ãƒ³ã‚°](http://wisdom.sakura.ne.jp/system/opengl/gl23.html)ã¨ã„ã†ã‚‚ã®ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã¯ç”»åƒã‚’è²¼ã‚Šä»˜ã‘ã‚‹æ¿ã¿ãŸã„ãªã‚‚ã®ã§ã€æ¿ã®è§’ã®åº§æ¨™ã¨ç”»åƒã®è§’ã®åº§æ¨™ã‚’å¯¾å¿œã•ã›ã‚‹ã“ã¨ã§ã€

æ¿ã‚’ç§»å‹•ã•ã›ãŸã‚Šå›è»¢ã•ã›ãŸã‚Šã—ã¦ã‚‚ç”»åƒãŒå‹•ã„ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã¨ã„ã†æ„Ÿã˜ã§ã™ã­ã€‚

ãã‚Œã§ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®è¨­å®šãŒå¿…è¦ãªã®ã§ã™ãŒã€æ­£ç›´è¨€ã£ã¦ä½•ã‚’ã‚„ã£ã¦ã„ã‚‹ã‹ã‚ˆãã‚ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚ç¬‘

ã“ã¡ã‚‰ã®è¨˜äº‹ã¨ã‹èª­ã‚€ã¨ãªã‚“ã¨ãªãã‚ã‹ã‚‹ã‹ã‚‚ã€‚

â†’ [OpenGL ã§ã‚²ãƒ¼ãƒ ã‚’ä½œã‚‹ã€€ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’è¡¨ç¤ºã™ã‚‹](http://nn-hokuson.hatenablog.com/entry/2014/02/05/001602)

```py:utils.py
from PIL import Image
...
ã€€
ã€€
def set_img(name, path, imgID):
    '''ç”»åƒã®è¨­å®š: name.pngã‚’èª­ã¿è¾¼ã‚€

    Parameters
    ----------
    name : str
        ç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«åï¼
    path : str > 'W', 'B'
        ç”»åƒãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€åï¼
    imgID : int
        æŒ‡å®šã™ã‚‹ç”»åƒIDï¼
    '''
    img = Image.open(f'../img/{path}/{name}.png')   # ç”»åƒã‚’èª­ã¿è¾¼ã‚€
    w, h = img.size                                 # ç”»åƒã®æ¨ªå¹…ã€ç¸¦å¹…
    glBindTexture(GL_TEXTURE_2D, imgID)             # imgID ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹
    # ç”»åƒã¨ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’é–¢é€£ã¥ã‘ã‚‹
    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, w, h, 0,
        GL_RGBA, GL_UNSIGNED_BYTE, img.tobytes())
    # ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®è¨­å®š
    glTexParameter(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR)
    glTexParameter(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR)
ã€€
ã€€
def draw_img(x, y, imgID):
    '''ç”»åƒã‚’æç”»ã™ã‚‹

    Parameters
    ----------
    x, y : float
        æç”»ã™ã‚‹åº§æ¨™ï¼
    imgID : int
        ç”»åƒIDï¼
    '''
    glPushMatrix()          # å¤‰å½¢ç¯„å›²ã®é–‹å§‹
    glBindTexture(GL_TEXTURE_2D, imgID)     # imgID ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹
    glTranslate(x, y, 0)    # å¹³è¡Œç§»å‹•
    glColor(1, 1, 1)        # è‰²æŒ‡å®š
ã€€
    # ãƒ†ã‚¯ã‚¹ãƒãƒ£åº§æ¨™ã‚’æŒ‡å®šã™ã‚‹
    glBegin(GL_QUADS)
    glTexCoord(0.0, 1.0)
    glVertex(-1.0 / 2, -1.0 / 2)
    glTexCoord(1.0, 1.0)
    glVertex(1.0 / 2, -1.0 / 2)
    glTexCoord(1.0, 0.0)
    glVertex(1.0 / 2, 1.0 / 2)
    glTexCoord(0.0, 0.0)
    glVertex(-1.0 / 2, 1.0 / 2)
    glEnd()
ã€€
    glPopMatrix()           # å¤‰å½¢ç¯„å›²ã®çµ‚äº†
ã€€
ã€€
def draw_pieces(gameboard, imgID_dict, size=8):
    '''é§’ã‚’æç”»ã™ã‚‹

    Parematers
    ----------
    gameboard : dict > {(int, int): obj, ...}
        ç›¤é¢ï¼
    imgID : int
        ç”»åƒIDï¼
    size : int, default 8
        ç›¤é¢ã®å¤§ãã•ï¼
    '''
    glEnable(GL_TEXTURE_2D)    # ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–
    for i in range(size):
        for j in range(size):
            piece = gameboard.get((i, j))    # (i, j)ã«ã‚ã‚‹é§’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—
            if piece:
                draw_img(i, j, imgID_dict[piece.name])
    glDisable(GL_TEXTURE_2D)   # ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ç„¡åŠ¹åŒ–
```

ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¯æ•´æ•°ã®ç•ªå·ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

`glTexImage2D()`ã®æœ€å¾Œã®å¼•æ•°ã¯`img.tobytes()`ã¨ã„ã†ãµã†ã«ã€ãƒã‚¤ãƒˆã«å¤‰æ›ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã‚ˆã†ã§ã™ã€‚

`imgID_dict`ã¯`{'WN': 1, 'WR': 2, ...}`ã¿ãŸã„ãªæ„Ÿã˜ã®
{{% tooltip %}}ãƒ‡ã‚£ã‚¯ã‚·ãƒ§ãƒŠãƒª((ã‚­ãƒ¼ã¨å€¤ãŒ 1 å¯¾ 1 ã«å¯¾å¿œã™ã‚‹å½¢ã§ã¾ã¨ã‚ã‚‰ã‚ŒãŸæ§‹é€ {{% /tooltip %}}
ã«ã—ã¦ã„ã¾ã™ã€‚

```py:pieces.py
class Knight(Piece):
    abbr = 'N'
    def availableMoves(self, x, y, gameboard, Color=None):
        ...
ã€€
class Rook(Piece):
    abbr = 'R'
    def availableMoves(self, x, y, gameboard, Color=None):
        ...
...
ã€€
piece_names = [Knight, Rook, Bishop, Queen, King, Pawn]
ã€€
# ç”»åƒIDã®å‰²ã‚Šå½“ã¦
piece_ID = {}
for i, piece in enumerate(piece_names):
    piece_ID['W' + piece.abbr] = i + 1
    piece_ID['B' + piece.abbr] = -(i + 1)
```

[å…ƒã®ã‚³ãƒ¼ãƒ‰ã®`uniDict`](https://gist.github.com/rsheldiii/2993225#file-chess-py-L234)ã¯ã€ã‚ã¨ã‹ã‚‰ã¾ã¨ã‚ã¦æŒ‡å®šã—ã¦ã„ã‚‹æ„Ÿã˜ã§ã™ãŒã€

ã“ã‚Œã‹ã‚‰é§’ãŒå¢—ãˆã¦ã„ãã®ã«å‚™ãˆã¦ã€å„é§’ã®ã‚¯ãƒ©ã‚¹å†…ã§é§’ã‚’è¡¨ã™æ–°ãŸãª
{{% tooltip %}}ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£((ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå‚ç…§ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿{{% /tooltip %}}
ï¼ˆ`abbr`ï¼‰ã‚’å®šç¾©ã—ã¾ã—ãŸã€‚

`uniDict`ã‚’ä½¿ã‚ãªããªã£ãŸã®ã§ã€é–¢ä¿‚å„æ‰€ã§èª¿æ•´ã‚’å…¥ã‚Œã¤ã¤ã€

ç”»åƒé–¢é€£ã®å‡¦ç†ã‚‚å…¥ã‚Œè¾¼ã¿ã¾ã™ã€‚

```py {name="main.py", hl_lines=["3-6", "11-14", 19, "25-27"], ins=[2, 3, "6-11"], del=[0, 1, 4, 5], inline_hl=[0:["13-18"], 1:["13-18"], 2:["13-14"], 3:["13-14"], 4:["15-22"], 5:["15-22"], 6:["15-23"], 7:["15-23"]]}
def placePieces(self):
    for i in range(0, 8):
        self.gameboard[(i, 1)] = Pawn(WHITE, uniDict[WHITE][Pawn], 1)
        self.gameboard[(i, 6)] = Pawn(BLACK, uniDict[BLACK][Pawn], -1)
        self.gameboard[(i, 1)] = Pawn(WHITE, 'WP', 1)
        self.gameboard[(i, 6)] = Pawn(BLACK, 'BP', -1)
ã€€
    placers = [Rook, Knight, Bishop, Queen, King, Bishop, Knight, Rook]
ã€€
    for i in range(0, 8):
        self.gameboard[(i, 0)] = placers[i](WHITE,uniDict[WHITE][placers[i]])
        self.gameboard[(i, 7)] = placers[i](BLACK,uniDict[BLACK][placers[i]])
        self.gameboard[(i, 0)] = placers[i](WHITE, 'W' + placers[i].abbr)
        self.gameboard[(i, 7)] = placers[i](BLACK, 'B' + placers[i].abbr)
...
ã€€
def draw(self):
    ...
    draw_pieces(self.gameboard, piece_ID)
    ...
...
ã€€
def glmain(self):
    ...
    # ç”»åƒã®è¨­å®š
    for name, num in piece_ID.items():
        set_img(name, name[0], num)
ã€€
    glutMainLoop()
```

ã“ã‚Œã§ã„ã£ãŸã‚“è¡¨ç¤ºã•ã›ã¦ã¿ã¾ã™ã€‚

{{< img src=board1 ext=png width=300 alt=ç”»åƒé€éãªã— >}}

ãŠã£ã¨ã€[é€éã®è¨­å®š](http://wisdom.sakura.ne.jp/system/opengl/gl17.html)ã‚’ã—ãªã‘ã‚Œã°ã„ã‘ã¾ã›ã‚“ã­ã€‚

### é€éã®è¨­å®š

ä¸€å¿œç”»åƒã¯é€éæƒ…å ±ã‚‚å…¥ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ OpenGL ã«é€éæƒ…å ±ã‚’å«ã‚ã¦æç”»ã—ã¦ã‚‚ã‚‰ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```py:main.py {hl_lines=[5, 6, 9]}
def draw(self):
    '''æç”»ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯'''
    glClearColor(0.6, 0.4, 0.2, 1.0)
    glClear(GL_COLOR_BUFFER_BIT)
    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)    # æ··åˆå‡¦ç†ã®æ¼”ç®—æ–¹æ³•ã‚’æŒ‡å®š
    glEnable(GL_BLEND)        # æ··åˆå‡¦ç†ã‚’æœ‰åŠ¹åŒ–
    ...
    draw_pieces(self.gameboard, piece_ID)
    glDisable(GL_BLEND)        # æ··åˆå‡¦ç†ã‚’ç„¡åŠ¹åŒ–
    glutSwapBuffers()
```

{{< img src=board2 ext=png width=300 alt=ç”»åƒé€éã‚ã‚Š >}}

å•é¡Œãªãè¡¨ç¤ºã§ãã¾ã—ãŸï¼

---

ã“ã‚Œã§è¡¨ç¤ºã¯ã§ããŸã‚ã‘ã§ã™ãŒã€ã¾ã é§’ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

<pstlk label="æ¬¡å›" to="chess-app-devel-8" />ã¯ãƒã‚¦ã‚¹æ“ä½œã§é§’ã‚’å‹•ã‹ã›ã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ã“ã®è¨˜äº‹ãŒãŠå½¹ã«ç«‹ã¦ãŸãªã‚‰ã†ã‚Œã—ã„ã§ã™â˜ºï¸

ãã‚Œã§ã¯ï½ğŸ‘‹
