---
title: "ãƒã‚§ã‚¹ã‚¢ãƒ—ãƒªé–‹ç™º(5) ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆãƒ»ã‚¹ãƒ†ã‚¤ãƒ«ãƒ¡ã‚¤ãƒˆã®åˆ¤å®š"
date: 2020-02-24T20:00:00+09:00
lastmod: 2020-04-21T21:00:00+09:00
categories: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, ãƒã‚§ã‚¹ã‚¢ãƒ—ãƒªé–‹ç™º]
tags: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, Python, ã‚¢ãƒ—ãƒªé–‹ç™º, ãƒã‚§ã‚¹]
summary: "Python ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§å‹•ã‹ã™ãƒ•ã‚§ã‚¢ãƒªãƒ¼ãƒã‚§ã‚¹ã‚¢ãƒ—ãƒªé–‹ç™ºã€é€£è¼‰ç¬¬5å›ã§ã™ã€‚

å‰å›ã¯è‡ªã‚‰ãƒã‚§ãƒƒã‚¯ã•ã‚Œã«è¡Œãã‚ˆã†ãªå‹•ããŒã§ããªã„ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

ä»Šå›ã¯ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆã‚„ã‚¹ãƒ†ã‚¤ãƒ«ãƒ¡ã‚¤ãƒˆã‚’åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚"
published: true
---

Python ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§å‹•ã‹ã™ãƒ•ã‚§ã‚¢ãƒªãƒ¼ãƒã‚§ã‚¹ã‚¢ãƒ—ãƒªé–‹ç™ºã€é€£è¼‰ç¬¬ 5 å›ã§ã™ã€‚

<pstlk label="å‰å›" to="chess-app-devel-4" />ã¯è‡ªã‚‰ãƒã‚§ãƒƒã‚¯ã•ã‚Œã«è¡Œãã‚ˆã†ãªå‹•ããŒã§ããªã„ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

ä»Šå›ã¯
<tltp label="ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆ">ã‚­ãƒ³ã‚°ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã¦ã€ä¸€æ‰‹ã§ãƒã‚§ãƒƒã‚¯ã‹ã‚‰é€ƒã‚Œã‚‹ã“ã¨ãŒã§ããªã„çŠ¶æ…‹</tltp>ã‚„
<tltp label="ã‚¹ãƒ†ã‚¤ãƒ«ãƒ¡ã‚¤ãƒˆ">ã‚­ãƒ³ã‚°ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„ãŒã€æ‰“ã¤æ‰‹ãŒãªã„çŠ¶æ…‹</tltp>
ã‚’åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

<!--more-->

## å‹•ã‹ã›ã‚‹é§’ãŒã‚ã‚‹ã‹ã©ã†ã‹ã®åˆ¤å®š

ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆã‚’åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆã¨ãƒã‚§ãƒƒã‚¯ã¯ä½•ãŒé•ã†ã‹ã¨ã„ã†ã¨ã€

**ãƒã‚§ãƒƒã‚¯ã¯ä¸€æ‰‹ã§ãƒã‚§ãƒƒã‚¯ã˜ã‚ƒãªãã§ãã‚‹ã‘ã©ã€ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆã¯ã©ã†ã‚ãŒã„ã¦ã‚‚ãƒã‚§ãƒƒã‚¯ã‚’å…ã‚Œãªã„**

ã¨ã„ã†ç‚¹ã§ã™ã€‚

ãƒã‚§ãƒƒã‚¯ã¨ã„ã†ã®ãŒã‚­ãƒ³ã‚°ãŒæ•µé§’ã«æ”»æ’ƒã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã‹ã‚‰ã€

ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆã¯ã‚­ãƒ³ã‚°ã‚’ç›¸æ‰‹ã®æ”»æ’ƒç¯„å›²å¤–ã«ã™ã‚‹ã“ã¨ãŒä¸€æ‰‹ã§ã¯ã§ããªã„ã¨ã„ã†çŠ¶æ…‹ã§ã™ã­ã€‚

å‰å›ã§è‡ªã‚‰ãƒã‚§ãƒƒã‚¯ã•ã‚Œã«è¡Œãã‚ˆã†ãªå‹•ãã¯å‡ºæ¥ãªããªã‚Šã¾ã—ãŸã€‚

ã¤ã¾ã‚Šã©ã†å‹•ã„ã¦ã‚‚ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã—ã¾ã†ã¨ã„ã†ã¨ãã¯ã©ã“ã«ã‚‚å‹•ã‘ã¾ã›ã‚“ã€‚

å‹•ã‹ã›ã‚‹é§’ãŒãªã„ã¨ãã€ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆã¾ãŸã¯ã‚¹ãƒ†ã‚¤ãƒ«ãƒ¡ã‚¤ãƒˆã§ã‚ã‚‹ã¨è¨€ãˆã¾ã™ã€‚

ã©ã®é§’ã‚‚å‹•ã‹ã™ã“ã¨ãŒã§ããªã„ã¨ãã€`True`ã‚’è¿”ã™ã‚ˆã†ãª
<tltp label="ãƒ¡ã‚½ãƒƒãƒ‰">ã‚¯ãƒ©ã‚¹å†…ã§å®šç¾©ã•ã‚Œã‚‹é–¢æ•°ã®ã‚ˆã†ãªã‚‚ã®</tltp>
ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚

```py name=main.py
class Game:
    ...
    def cannotMove(self, color, gameboard):
        '''colorå´ãŒé§’ã‚’å‹•ã‹ã›ãªã„ã¨ãTrueã‚’è¿”ã™'''
        for position, piece in gameboard.items():
            # ç›¤é¢ä¸Šã®é§’ã®ä½ç½®ã¨é§’ã«ã¤ã„ã¦
            if color == piece.Color:
                # é§’è‰²ãŒcolorã®ã¨ã
                for dest in piece.availableMoves(*position, gameboard, Color=color):
                    # é§’ã®ç§»å‹•å…ˆã«ã¤ã„ã¦
                    # ç§»å‹•å¾Œã«ãƒã‚§ãƒƒã‚¯å›é¿ã§ãã‚‹ãªã‚‰False
                    gameboardTmp = copy(gameboard)
                    gameboardTmp[dest] = gameboardTmp[position]
                    del gameboardTmp[position]
                    if not self.isCheck(color, gameboardTmp):
                        return False
        # colorã®ã©ã®é§’ã‚’ã©ã®ã‚ˆã†ã«ç§»å‹•ã•ã›ã¦ã‚‚ãƒã‚§ãƒƒã‚¯å›é¿ã§ããªã‹ã£ãŸã¨ã
        return True
```

13, 14 è¡Œç›®ã®å½¢ã¯ä»Šã¾ã§ã‚‚ä½•åº¦ã‹å‡ºã¦ãã¾ã—ãŸã€‚

ã“ã®éš›ã“ã® 2 è¡Œã‚’è¡¨ã™ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œã£ã¦ã—ã¾ã„ã¾ã—ã‚‡ã†ã€‚

```py name=main.py
class Game:
    ...
    def renewGameboard(self, startpos, endpos, gameboard):
        '''ç›¤é¢ã‚’æ›´æ–°ã™ã‚‹'''
        gameboard[endpos] = gameboard[startpos]
        del gameboard[startpos]
```

ã“ã‚Œã§`main()`ã¨`isValidMove()`ã¨`cannotMove()`ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```py name=main.py hl_lines=10,18,32
class Game:
    ...
    def main(self):
        while True:
            ...
            if target:
                ...
                if self.isValidMove(target, startpos, endpos, self.gameboard):
                    self.message = "that is a valid move"
                    self.renewGameboard(startpos, endpos, self.gameboard)
                    self.isCheck(target.Color, self.gameboard)
                    ...
    ...
    def isValidMove(self, piece, startpos, endpos, gameboard):
        '''pieceã®startpos -> endposã®å‹•ããŒå¯èƒ½ã§ã‚ã‚‹ã¨ãTrueã‚’è¿”ã™'''
        if endpos in piece.availableMoves(startpos[0], startpos[1], gameboard, Color=piece.Color):
            gameboardTmp = copy(gameboard)
            self.renewGameboard(startpos, endpos, gameboardTmp)
            if self.isCheck(piece.Color, gameboardTmp):
                return False
            else:
                return True
        else:
            return False
    ...
    def cannotMove(self, color, gameboard):
        '''colorå´ãŒé§’ã‚’å‹•ã‹ã›ãªã„ã¨ãTrueã‚’è¿”ã™'''
        for position, piece in gameboard.items():
            if color == piece.Color:
                for dest in piece.availableMoves(*position, gameboard, Color=color):
                    gameboardTmp = copy(gameboard)
                    self.renewGameboard(position, dest, gameboardTmp)
                    if not self.isCheck(color, gameboardTmp):
                        return False
        return True
```

ã•ã¦ã€ã“ã‚Œã§`cannotMove() and isCheck()`ãªã‚‰ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆã€

`cannotMove() and not isCheck()`ãªã‚‰ã‚¹ãƒ†ã‚¤ãƒ«ãƒ¡ã‚¤ãƒˆã§ã™ã€‚

<br/>

## åˆ¤å®šã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º

ã‚ã¨ã¯ã“ã‚Œã‚’é©åˆ‡ãªä½ç½®ã«ãŠã„ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚è¡¨ç¤ºã•ã›ã‚Œã° OK ã§ã™ã€‚

ãƒã‚§ãƒƒã‚¯ã¨åŒã˜å ´æ‰€ã«ç½®ããŸã„ã§ã™ã­ã€‚

ã©ã“ã§åˆ¤å®šã—ã¦ã©ã“ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã—ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚

```py name=main.py hl_lines=11,22
class Game:
    ...
    def main(self):
        while True:
            ...
            if target:
                ...
                if self.isValidMove(target, startpos, endpos, self.gameboard):
                    self.message = "that is a valid move"
                    self.renewGameboard(startpos, endpos, self.gameboard)
                    self.isCheck(target.Color, self.gameboard)
                    ...
    ...
    def isCheck(self, color, gameboard):
        kingDict = {}
        pieceDict = {BLACK : [], WHITE : []}
        for position, piece in gameboard.items():
            if type(piece) == King:
                kingDict[piece.Color] = position
            pieceDict[piece.Color].append((piece, position))
        if self.canSeeKing(kingDict[color], pieceDict[opponent[color]], gameboard):
            self.message = f"{color} player is in check"
            return True
```

ã©ã†ã‚„ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯`self.message`ãŒè«‹ã‘è² ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

ã›ã£ã‹ã`isCheck()`ã«çœŸå½åˆ¤å®šã‚’ã•ã›ã¦ã„ã‚‹ã®ã§ã€ã“ã£ã¡ã®æ›¸ãæ–¹ã®ã»ã†ãŒã™ã£ãã‚Šã™ã‚‹ã‹ãªã€‚

```py name=main.py ins=12-13 del=11,24 inline_hl=12:1,14
class Game:
    ...
    def main(self):
        while True:
            ...
            if target:
                ...
                if self.isValidMove(target, startpos, endpos, self.gameboard):
                    self.message = "that is a valid move"
                    self.renewGameboard(startpos, endpos, self.gameboard)
                    self.isCheck(target.Color, self.gameboard)
                    if self.isCheck(target.Color, self.gameboard):
                        self.message = f"{target.Color} player is in check"
                    ...
    ...
    def isCheck(self, color, gameboard):
        kingDict = {}
        pieceDict = {BLACK : [], WHITE : []}
        for position, piece in gameboard.items():
            if type(piece) == King:
                kingDict[piece.Color] = position
            pieceDict[piece.Color].append((piece, position))
        if self.canSeeKing(kingDict[color], pieceDict[opponent[color]], gameboard):
            self.message = f"{color} player is in check"
            return True
```

ç§»ã—ã¦ã¿ã¾ã—ãŸã€‚

åŒã˜è¦é ˜ã§ã€ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚¤ãƒˆã‚„ã‚¹ãƒ†ã‚¤ãƒ«ãƒ¡ã‚¤ãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚ç››ã‚Šè¾¼ã‚ã¾ã™ã­ã€‚

ã‚ã¨ã€ãƒ¡ã‚¤ãƒˆã«ãªã‚‹ã¨ã‚²ãƒ¼ãƒ ã¯çµ‚äº†ã™ã‚‹ã®ã§ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’çµ‚äº†ã•ã›ã‚‹ã‚ˆã†ã«ã¾ã—ã‚‡ã†ã€‚

```py name=main.py hl_lines=13-19
import sys
ã€€
def main(self):
    while True:
        ...
        if target:
            ...
            if self.isValidMove(target, startpos, endpos, self.gameboard):
                self.message = "that is a valid move"
                self.renewGameboard(startpos, endpos, self.gameboard)
                if self.isCheck(target.Color, self.gameboard):
                    self.message = f"{target.Color} player is in check"
                if self.cannotMove(target.Color, self.gameboard):
                    if self.isCheck(target.Color, self.gameboard):
                        self.message = f"Checkmate! {opponent[target.Color]} player won!"
                        sys.exit()
                    else:
                        self.message = "Stalemate! It's draw."
                        sys.exit()
                ...
```

---

ã“ã‚Œã¾ã§ã®å›ã§ã€å½“åˆæŒ‡æ‘˜ã•ã‚Œã¦ã„ãŸå•é¡Œç‚¹ã®ã»ã¨ã‚“ã©ã¯è§£æ±ºã—ã¾ã—ãŸã€‚

ã‚­ãƒ£ã‚¹ãƒªãƒ³ã‚°ã‚„ã‚¢ãƒ³ãƒ‘ãƒƒã‚µãƒ³ãªã©ã®å®Ÿè£…ã‚‚ã—ãŸã„ã®ã§ã™ãŒã€

ãã®å‰ã«è¦‹ãŸç›®ã‚„éŠã³æ–¹ã‚’ã‚²ãƒ¼ãƒ ã£ã½ãã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

æ¬¡å›ã¯<pstlk label="ã“ã¡ã‚‰" to="chess-app-devel-6" />

ãã‚Œã§ã¯ã¾ãŸğŸ‘‹
