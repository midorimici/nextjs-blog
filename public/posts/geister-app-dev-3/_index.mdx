---
title: "ã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªé–‹ç™º(3) é§’ã‚’é…ç½®ã™ã‚‹ç”»é¢ï¼ˆãƒã‚¦ã‚¹æ“ä½œï¼‰"
date: 2020-12-13T12:00:00+09:00
lastmod: 2020-12-18T12:00:00+09:00
topics: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, Python, ã‚¢ãƒ—ãƒªé–‹ç™º]
published: true
---
Python ã§ã¤ãã‚‹ã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ã€é€£è¼‰ç¬¬ 3 å›ã§ã™ã€‚

<pstlk label="å‰å›" to="geister-app-dev-2" />ã¯ã‚°ãƒªãƒƒãƒ‰ã‚„ãƒœã‚¿ãƒ³ã‚’æç”»ã—ã¾ã—ãŸã€‚

ä»Šå›ã¯ãƒã‚¦ã‚¹æ“ä½œã§ã‚°ãƒªãƒƒãƒ‰ã«é§’ã‚’ç½®ã„ãŸã‚Šã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚Šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

<!--more-->

<br/>

## ã‚¯ãƒªãƒƒã‚¯ã§é§’ã‚’ç½®ã

pygame ã§ã¯`pygame.event.get()`ã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã—ã€`event.type`ã§ã‚¤ãƒ™ãƒ³ãƒˆã®ç¨®é¡ï¼ˆãƒã‚¦ã‚¹ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãªã©ï¼‰ã‚’å–å¾—ã—ã¾ã™ã€‚

ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯ãªã‚‰`event.type == MOUSEBUTTONDOWN`ã§ã€

å·¦ã‚¯ãƒªãƒƒã‚¯ãªã‚‰ã•ã‚‰ã«`event.button == 1`ã€å³ã‚¯ãƒªãƒƒã‚¯ã§ãªã‚‰`event.button == 3`ã¨ã„ã†æ¡ä»¶ãŒã¤ãã¾ã™ã€‚

ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®ã¯`event.pos`ã‹ã‚‰èª­ã¿è¾¼ã‚ã¾ã™ã€‚

ã‚¯ãƒªãƒƒã‚¯ã®ç¨®é¡ã¨ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```py name=main.py
...
def main():
    ...
    while True:
        ...
        for event in pygame.event.get():
            # ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯
            if event.type == MOUSEBUTTONDOWN:
                # å·¦
                if event.button == 1:
                    print('left:', event.pos)
                # å³
                elif event.button == 3:
                    print('right:', event.pos)
```

ã“ã‚Œã§å–å¾—ã§ãã‚‹åº§æ¨™ã¯ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åº§æ¨™ã§ã™ãŒã€æ‰±ã„ã‚„ã™ã„ã‚ˆã†ã«ã‚²ãƒ¼ãƒ å†…ã®åº§æ¨™ã«å¤‰æ›ã—ã¾ã™ã€‚

### åº§æ¨™å¤‰æ›

ãƒã‚¦ã‚¹ã§ç‰¹å®šã®ä½ç½®ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã€ãã®ãƒã‚¹ç›®ã®åº§æ¨™ï¼ˆ(1, 2) ãªã©ï¼‰ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã®é–¢æ•°ã¯ãƒã‚¦ã‚¹é–¢é€£ã®å‡¦ç†ã‚’ã¾ã¨ã‚ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å®šç¾©ã—ã¾ã™ã€‚

```py name=mouse.py
from config import *

def chcoord(pos):
    '''
    åº§æ¨™ pos ãŒã©ã®ãƒã‚¹ä¸Šã«ã‚ã‚‹ã‹ãã®ä½ç½®ã‚’è¿”ã™
    -> tuple <- (int, int)
    (0, 0)â”‚...â”‚(5, 0)
    â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€
           ...
    â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€
    (5, 0)â”‚...â”‚(5, 5)

    pos : tuple <- (int, int)
        å¯¾è±¡ã®åº§æ¨™
    '''
    return (pos-MARGIN)//SQUARE_SIZE
```

ã“ã‚Œã§ã‚²ãƒ¼ãƒ å†…ã®åº§æ¨™ãŒå–å¾—ã§ãã‚‹ã®ã§ã€ã‚¯ãƒªãƒƒã‚¯ã—ãŸä½ç½®ãŒã©ã“ã‹ã‚’åˆ¤å®šã—ã¦ã€

ãã®ãƒã‚¹ã®ä¸­ã«é§’ã‚’ç½®ã„ã¦ã„ãã¾ã™ã€‚

### é§’ã‚’ç½®ã

é§’ãŒã©ã®ã‚ˆã†ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’è¡¨ã™å¤‰æ•°ã‚’ç”¨æ„ã—ã¦ã€ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«ãã®å¤‰æ•°ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```py name=main.py hl_lines=6-11,15,24-29,32-37
...
import draw, mouse

def main():
    ...
    # é…ç½®ã‚’æ±ºå®šã™ã‚‹å´
    # 0 - å…ˆæ”», 1 - å¾Œæ”»
    _state = 0
    # æ±ºå®šã•ã‚ŒãŸåˆæœŸé…ç½®ã¨è‰²
    # [{(int, int): str}]
    _order = [{}, {}]
    ...
    while True:
        screen.fill(IVORY)
        draw.setup(screen, font, _state)
        pygame.display.update()
        # ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        for event in pygame.event.get():
            ...
            # ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯
            if event.type == MOUSEBUTTONDOWN:
                # å·¦
                if event.button == 1:
                    _mouse_pos = event.pos
                    _square_pos = tuple(mouse.chcoord(_mouse_pos))
                    for i in range(1, 5):
                        for j in range(2, 4):
                            if _square_pos == (i, j):
                                _order[_state][(i, j)] = 'R'
                # å³
                elif event.button == 3:
                    _mouse_pos = event.pos
                    _square_pos = tuple(mouse.chcoord(_mouse_pos))
                    for i in range(1, 5):
                        for j in range(2, 4):
                            if _square_pos == (i, j):
                                _order[_state][(i, j)] = 'B'
            ...
```

ãã®å¤‰æ•°ã«ã—ãŸãŒã£ã¦é§’ã‚’æç”»ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```py name=draw.py ins=3,10-11 del=2 inline_hl=3:10-11
...
def setup(screen, font, turn):
def setup(screen, font, turn, posdict):
    '''
    ...
    posdict : dict <- {(int, int): str}
        ã©ã®ä½ç½®ã«ã©ã®è‰²ã®é§’ãŒç½®ã‹ã‚Œã¦ã„ã‚‹ã‹ã‚’è¡¨ã™è¾æ›¸
    '''
    ...
    for (x, y), s in posdict.items():
        _piece(screen, RED if s == 'R' else BLUE, (x, y))
    ...
```

```py name=main.py hl_lines=6 inline_hl=6:9-13
...
def main():
    ...
    while True:
        screen.fill(IVORY)
        draw.setup(screen, font, _state, _order[_state])
        ...
```

<video src="set_piece" />

<br/>

## ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™

ãƒœã‚¿ãƒ³ä¸Šã«ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ãŒã‚ã‚‹ã¨ãã«å·¦ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ä½•ã‚‰ã‹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’èµ·ã“ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

é§’ã¯èµ¤ã¨é’ 4 å€‹ãšã¤ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã®ã§ã€ãã®æ¡ä»¶ã‚’æº€ãŸã•ãªã„ã¨ãƒœã‚¿ãƒ³ãŒæŠ¼ã›ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

<br/>

æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹åˆ¤å®šã™ã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚

```py name=main.py
...
def _check_color(colors):
    '''
    é§’ãŒã™ã¹ã¦é…ç½®æ¸ˆã¿ã§èµ¤ã¨é’ãŒåŠåˆ†ãšã¤ã‚ã‚‹ã‹
    -> bool

    colors : list <- [str]
        è‰²ã®ãƒªã‚¹ãƒˆ
    '''
    return (len(colors) == 8
        and len([s for s in colors if s == 'R'])
            == len([s for s in colors if s == 'B']))
...
```

ãƒã‚¦ã‚¹ã®åº§æ¨™ãŒãƒœã‚¿ãƒ³ã«ã®ã£ã¦ã„ã‚‹ã‹èª¿ã¹ã‚‹ãŸã‚ã€åˆ¥ã®é–¢æ•°ã‚‚å®šç¾©ã—ã¾ã™ã€‚

ï¼ˆå·¦ä¸Šã®ã»ã†ãŒåº§æ¨™ãŒå°ã•ã„ã“ã¨ã«æ³¨æ„ï¼‰

```py name=mouse.py
...
def on_area(x, y, left, top, w, h):
    '''
    åº§æ¨™ x, y ãŒç¯„å›²å†…ã«ã‚ã‚‹ã‹
    -> bool

    x, y : int
        å¯¾è±¡ã®åº§æ¨™
    left, top : int
        ç¯„å›²ã®å·¦ãƒ»ä¸Šç«¯ã®åº§æ¨™
    w, h : int
        ç¯„å›²ã®æ¨ªãƒ»ç¸¦å¹…
    '''
    return left <= x <= left+w and top <= y <= top+h
...
```

<br/>

ãã—ã¦ã€æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã¨ãã‹ã¤ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã«ã®ã¿æ¬¡ã®ç”»é¢ã«é€²ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

```py name=main.py hl_lines=5,10-12
...
def main():
    ...
    while True:
        satisfied = _check_color(list(_order[_state].values()))
        ...
                # å·¦
                if event.button == 1:
                    ...
                    if mouse.on_area(*_mouse_pos, 500, 530, 80, 50):
                        if satisfied:
                            _state += 1
                ...
```

ã•ã‚‰ã«ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã›ã‚‹ã¨ãã¨æŠ¼ã›ãªã„ã¨ãã§ãƒœã‚¿ãƒ³ã®è‰²ã‚’å¤‰ãˆã¾ã™ã€‚

```py name=draw.py ins=3,11 del=2,10 inline_hl=3:12-13;11:24-25
...
def setup(screen, font, turn, posdict):
def setup(screen, font, turn, posdict, disabled):
    '''
    ...
    disabled : bool
        ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ãªã„
    '''
    ...
    _button(screen, font, (500, 530), (80, 50), 'OK')
    _button(screen, font, (500, 530), (80, 50), 'OK', disabled)
...
```

```py name=main.py hl_lines=6 inline_hl=6:14-17
...
def main():
    ...
    while True:
        ...
        draw.setup(screen, font, _state, _order[_state], not satisfied)
        ...
```

ã“ã‚Œã§ã€é§’ãŒé©åˆ‡ã«é…ç½®ã•ã‚ŒãŸã¨ãã«ã®ã¿ãƒœã‚¿ãƒ³ãŒæŠ¼ã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

<video src="button" />

å³ä¸‹ã®ãƒœã‚¿ãƒ³ã®è‰²ãŒå¤‰ã‚ã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚

<br/>

## åŠ¹æœéŸ³ã‚’ã¤ã‘ã‚‹

ãŠã¾ã‘ã§ã™ãŒã€é§’ã‚’ç½®ã„ãŸã¨ãã‚„ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«åŠ¹æœéŸ³ã‚’ã¤ã‘ã¦ã¿ã¾ã™ã€‚

```py name=main.py hl_lines=4-8,20,25,28
...
def main():
    pygame.init()
    # éŸ³å£°ã®è¨­å®š
    snd = pygame.mixer.Sound
    select_snd = snd('./sounds/select.wav')
    decide_snd = snd('./sounds/decide.wav')
    forbid_snd = snd('./sounds/forbid.wav')
    ...
    while True:
        ...
                # å·¦
                if event.button == 1:
                    _mouse_pos = event.pos
                    _square_pos = tuple(mouse.chcoord(_mouse_pos))

                    for i in range(1, 5):
                        for j in range(2, 4):
                            if _square_pos == (i, j):
                                select_snd.play()
                                _order[_state][(i, j)] = 'R'
                    
                    if mouse.on_area(*_mouse_pos, 500, 530, 80, 50):
                        if satisfied:
                            decide_snd.play()
                            _state += 1
                        else:
                            forbid_snd.play()
        ...
```

åˆæœŸåŒ–ã—ã¦ã€ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦éŸ³ã‚’å–ã‚Šè¾¼ã‚“ã§ã€è©²å½“éƒ¨åˆ†ã§å†ç”Ÿã™ã‚‹ã ã‘ã§ã™ã€‚

<relpos link="chess-app-devel-16" />

---

ã“ã‚Œã§é§’ã®åˆæœŸé…ç½®ã‚’é¸æŠã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

<pstlk label="æ¬¡å›" to="geister-app-dev-4" />ã¯ã“ã“ã§æ±ºå®šã—ãŸé…ç½®ã‚’ã‚²ãƒ¼ãƒ æœ¬ç•ªã§ã®åˆæœŸé…ç½®ã«åæ˜ ã—ã¦ã„ãã¾ã™ã€‚

ãŠèª­ã¿ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

ã§ã¯ğŸ‘‹
