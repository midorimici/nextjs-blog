---
title: "ã€React + Recoilã€‘ã¡ã‚‡ã£ã¨ãƒªãƒƒãƒãª ToDo ã‚¢ãƒ—ãƒª"
date: 2020-06-18T12:00:00+09:00
lastmod: 2020-06-18T12:00:00+09:00
categories: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, Web ã‚¢ãƒ—ãƒª]
tags: [React, ã‚¢ãƒ—ãƒªé–‹ç™º]
draft: false
---

ãŠã„ã—ãã†ãªã‚¿ã‚¤ãƒˆãƒ«ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

ã“ã‚Œã¾ã§ React ã§<pstlk label="æ–‡å­—å½“ã¦ã‚²ãƒ¼ãƒ  react-mojiate-game >}}ã‚„{{< pstlk ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ç·´ç¿’ã‚¢ãƒ—ãƒª" to="react-typing-app" />ã‚’ä½œã£ã¦ãã¾ã—ãŸãŒã€

ä»Šå›ã¯ ToDo ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã—ãŸã€‚

<!--more-->

{{< tweet 1272492269333962752 >}}

{{< sandbox "react-mui-todo-app" "https://codesandbox.io/s/react-mui-todo-app-gx6us?fontsize=14&hidenavigation=1&theme=dark" >}}

<br/>

ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ç·´ç¿’ã‚¢ãƒ—ãƒªåˆ¶ä½œã®ã¨ãã«ã¯ã‚¹ãƒ‘ã‚¤ã‚¹çš„ã«å…¥ã‚Œã¦ã„ãŸ [Material-UI](https://material-ui.com/ja/) ã‚’ã€

ä»Šå›ã¯å…¨é¢çš„ã«åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€2020å¹´5æœˆã«ç™ºè¡¨ã•ã‚ŒãŸçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª [Recoil](https://recoiljs.org/) ã‚’è©¦é¨“çš„ã«åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

<br/>

<strong>ã“ã®è¨˜äº‹ã§ã¯ã€Recoil ã® Atom ã¨ã„ã†æ©Ÿèƒ½ã®ç°¡å˜ãªèª¬æ˜ã‚’ã—ãŸå¾Œã«ã€

å®Ÿéš›ã®å®Ÿè£…ã«ã¤ã„ã¦æ›¸ã„ã¦ã„ãã¾ã™ã€‚</strong>

ä»Šå›ã¯ React Hooks ã‚„ Material-UI ã‚„ TypeScript ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ãŒã€

ãã‚Œã‚‰ã®ç°¡å˜ãªèª¬æ˜ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã‚’ã”è¦§ãã ã•ã„ã€‚

{{< relpos react-typing-app >}}

<br/>

## Recoil ã¨ã¯

Recoil ã¯2020å¹´5æœˆã«ç™ºè¡¨ã•ã‚ŒãŸã°ã‹ã‚Šã®æ–°ã—ã„ React ã®ãŸã‚ã®çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

React ã¯ã„ãã¤ã‹ã® state ã‚’æŒã¤ã“ã¨ãŒå¤šã„ã®ã§ã™ãŒã€

ã‚¢ãƒ—ãƒªãŒå¤§è¦æ¨¡ã«ãªã£ã¦ãã‚‹ã¨ã€**state ã®ç®¡ç†ãŒ React ã ã‘ã§ã¯è¾›ã**ãªã£ã¦ãã¾ã™ã€‚

ã¾ãŸã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¢—ãˆã‚‹ã¨ã€props ã§å¤‰æ•°ã‚’ä¸Šä½ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã—ã¦ã„ã<strong>ã€Œãƒã‚±ãƒ„ãƒªãƒ¬ãƒ¼ã€ãŒç™ºç”Ÿã—ã€

åŠ¹ç‡ãŒæ‚ªã</strong>ãªã‚Šã¾ã™ã€‚

<br/>

ãã“ã§ã€Redux ãªã©ã®çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä½¿ã‚ã‚Œã¾ã™ã€‚

ç®¡ç†ä¸‹ã«ç½®ã„ã¦ã„ã‚‹ state ã¯ã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã‚‚å‘¼ã³å‡ºã—ãŒå¯èƒ½ã§ã™ã€‚

Recoil ã¯ã€React Hooks ã¨ã»ã¼åŒã˜æ›¸ãæ–¹ã§çŠ¶æ…‹ç®¡ç†ã‚’å®Ÿç¾ã§ãã€

Redux ã‚ˆã‚Šã‚‚ç›´è¦³çš„ã§å°å…¥ã—ã‚„ã™ã„ã¨æ„Ÿã˜ãŸã®ã§ã€

Recoil ã‚’é¸æŠã—ã¾ã—ãŸã€‚

<br/>

Recoil ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã€ã‚³ãƒãƒ³ãƒ‰ã§`npm install recoil`ã¾ãŸã¯`yarn add recoil`ã¨ã™ã‚‹ã“ã¨ã§ã§ãã¾ã™ã€‚

### Atom

Atom ã¯ç®¡ç†ä¸‹ã«ãŠã state ã®ã“ã¨ã§ã™ã€‚

æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã—ã¾ã™ã€‚

```js {name="/src/atoms/text.js"}
import { atom } from 'recoil';

export const textState = atom({
    key: 'textState',
    default: ''
});
```

`key`ã«ã¯å…¨ä½“ã®ä¸­ã§ä¸€æ„çš„ãªï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªï¼‰ID ã‚’æŒ‡å®šã—ã¾ã™ã€‚

`default`ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã™ã€‚

<br/>

ã“ã‚Œã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã§ä½¿ã†ã«ã¯ã€æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```js {name="/src/components/App.js", hl_lines=[5]}
import { useRecoilState } from 'recoil';
import { textState } from '../atoms/text';

export default function App() {
    const [text, setText] = useRecoilState(textState);
    ...
}
```

ãªã‚“ã¨ React Hooks ã® useState ã¨ã»ã¼åŒã˜ã‚ˆã†ãªå½¢ã§ state ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€èª­ã¿è¾¼ã¿å°‚ç”¨ã€æ›¸ãè¾¼ã¿å°‚ç”¨ã®é–¢æ•°ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

```js {name="/src/components/App.js", hl_lines=[5, 6]}
import { useRecoilValue, useSetRecoilState } from 'recoil';
import { textState } from '../atoms/text';

export default function App() {
    const text = useRecoilValue(textState);         // èª­ã¿è¾¼ã¿å°‚ç”¨
    const setText = useSetRecoilState(textState);   // æ›¸ãè¾¼ã¿å°‚ç”¨
    ...
}
```

ã“ã‚Œã‚‰ã®é–¢æ•°ã‚’ä½¿ã†ã“ã¨ã§ã€ã‚ˆã‚ŠåŠ¹ç‡çš„ãªå‡¦ç†ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

<br/>

ãªãŠã€Recoil ã‚’ä½¿ã†ã¨ãã¯ã€

ä½¿ç”¨ç¯„å›²ã«å«ã‚ã‚‹æœ€ä¸Šéšå±¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’`RecoilRoot`ã‚¿ã‚°ã§å›²ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

{{< relpos react-toha >}}

<br/>

## å®Ÿè£…

ã“ã“ã‹ã‚‰ã¯ã€å®Ÿéš›ã®å®Ÿè£…ã«ã¤ã„ã¦è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

### ãƒ˜ãƒƒãƒ€ã®è¨­ç½®

Material-UI App Bar ã‚ˆã‚Šã€[Simple App Bar](https://material-ui.com/components/app-bar/#simple-app-bar) ã‚’ä½¿ã£ã¦ã€

ãƒ˜ãƒƒãƒ€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã‚µãƒ³ãƒ—ãƒ«ãŒæç¤ºã•ã‚Œã¦ã„ã‚‹ã®ã§ã€åŸºæœ¬çš„ã«ã¯ãã‚Œã‚’ã‚‚ã¨ã«ã—ã¦ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦ã„ãã¾ã™ã€‚

```jsx {name="/src/components/TodoAppBar.tsx"}
import React from 'react';
import AppBar from '@material-ui/core/AppBar';
import Toolbar from '@material-ui/core/Toolbar';
import Typography from '@material-ui/core/Typography';

export default function TodoAppBar() {
  return (
    <AppBar position="static">
      <Toolbar>
        <Typography variant="h6">TO DO</Typography>
      </Toolbar>
    </AppBar>
  );
}
```

`Typography`ã®éƒ¨åˆ†ã¯ã€ç›´æ¥`h6`ã¨æ›¸ã„ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚

```jsx {name="/src/App.tsx"}
import React from 'react';

import TodoAppBar from './components/TodoAppBar';

import './styles.css';

export default function App() {
  return (
    <DialogContent className="App">
      <TodoAppBar />
    </div>
  );
}
```

{{< img src=appbar alt="App Bar" >}}

å‡ºã¾ã—ãŸï¼

### ã‚¿ã‚¹ã‚¯æœªç™»éŒ²ã®ã¨ãã®ç”»é¢

ã‚¿ã‚¹ã‚¯ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ä¼ãˆã‚‹æ–‡ã¨ã€

ã‚¿ã‚¹ã‚¯ç™»éŒ²ã®ãŸã‚ã®ãƒœã‚¿ãƒ³ã‚’é…ç½®ã—ã¾ã™ã€‚

Material-UI Button ã‹ã‚‰ [Contained Buttons](https://material-ui.com/components/buttons/#contained-buttons) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```jsx {name="/src/components/TodoList.tsx"}
import React from 'react';

import { makeStyles, createStyles, Theme } from '@material-ui/core/styles';
import Box from '@material-ui/core/Box';
import Typography from '@material-ui/core/Typography';
import Button from '@material-ui/core/Button';

const useStyles = makeStyles((theme: Theme) =>
  createStyles({
    button: {
      '&:hover': {
        backgroundColor: '#6666ff'
      }
    }
  })
);

export default function TodoList() {
  const classes = useStyles();

  return (
    <Box padding="2rem" textAlign="center">
      <Typography variant="subtitle1" gutterBottom>
        ã¾ã ç™»éŒ²ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
      </Typography>
      <Button
        className={classes.button}
        variant="contained"
        color="primary"
        >
        ã‚¿ã‚¹ã‚¯ã‚’ç™»éŒ²ã™ã‚‹
      </Button>
    </Box>
  );
}
```

8-16è¡Œç›®ã¯ã€Material-UI ã‹ã‚‰ã‚¹ã‚¿ã‚¤ãƒ«æŒ‡å®šãŒã§ãã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚

`makeStyles - createStyles`ã¯ãŠã¾ã˜ãªã„ã®ã‚ˆã†ã«æ›¸ã„ã¦ã‚‚ã‚‰ã£ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚

`createStyles`ã®ä¸­ã«ã€ã‚¯ãƒ©ã‚¹åã€ã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›¸ãè¾¼ã‚“ã§ã„ãã¾ã™ã€‚

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…éƒ¨ã§ã“ã‚Œã‚’å‘¼ã³å‡ºã—ã€JSX ã®ã‚¿ã‚°ã«`className={classes.button}`ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚

<br/>

22è¡Œç›®ã®`Box`ã¯ Material-UI ã®ã‚‚ã®ã§ã™ãŒã€

ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç›´æ¥æ›¸ãè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

å‡ºåŠ›ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`div`ã«ãªã‚Šã¾ã™ã€‚

```jsx {name="/src/App.tsx", hl_lines=[4, 12]}
import React from 'react';

import TodoAppBar from './components/TodoAppBar';
import TodoList from './components/TodoList';

import './styles.css';

export default function App() {
  return (
    <div className="App">
      <TodoAppBar />
      <TodoList />
    </div>
  );
}
```

{{< img src=not-registered alt="ã‚¿ã‚¹ã‚¯æœªç™»éŒ²ç”»é¢" >}}

### ã‚¿ã‚¹ã‚¯ç™»éŒ²ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®è¡¨ç¤º

æ¬¡ã¯ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚‰æƒ…å ±ã‚’å…¥åŠ›ã™ã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã•ã›ã¾ã™ã€‚

Dialog ã® [Form dialogs](https://material-ui.com/components/dialogs/#form-dialogs) ã‚’å‚è€ƒã«ã—ã¾ã™ã€‚

```jsx {name="/src/components/RegisterDialog.tsx"}
import React from 'react';

import Button from '@material-ui/core/Button';
import Dialog from '@material-ui/core/Dialog';
import DialogActions from '@material-ui/core/DialogActions';
import DialogTitle from '@material-ui/core/DialogTitle';
import DialogContent from '@material-ui/core/DialogContent';
import DialogContentText from '@material-ui/core/DialogContentText';

type Props = {
  open: boolean;
  onClose: () => void;
};

export default function RegisterDialog({ open, onClose }: Props) {
  return (
    <Dialog
      open={open}
      onClose={onClose}
      aria-labelledby="form-dialog-title"
      fullWidth
    >
      <DialogTitle>ã‚¿ã‚¹ã‚¯ç™»éŒ²</DialogTitle>
      <DialogContent>
        <DialogContentText>
          ç™»éŒ²ã™ã‚‹ã‚¿ã‚¹ã‚¯ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
        </DialogContentText>
      </DialogContent>
      <DialogActions>
        <Button onClick={onClose} color="primary">
          ã‚‚ã©ã‚‹
        </Button>
        <Button color="primary">
          ç™»éŒ²
        </Button>
      </DialogActions>
    </Dialog>
  );
}
```

`open`ã¨`onClose`ã‚’ props ã¨ã—ã¦è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ã€ã•ãã»ã©ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«å‡ºç¾ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```jsx {name="/src/components/TodoList.tsx", hl_lines=[1, 8, "15-19", 22, 29, 36, 37], inline_hl=[1:["2-5"]]}
import React, { useState } from 'react';

import { makeStyles, createStyles, Theme } from '@material-ui/core/styles';
import Box from '@material-ui/core/Box';
import Typography from '@material-ui/core/Typography';
import Button from '@material-ui/core/Button';

import RegisterDialog from './RegisterDialog';

...

export default function TodoList() {
  const classes = useStyles();

  const [open, setOpen] = useState<boolean>(false);

  const handleOpen = () => setOpen(true);

  const handleClose = () => setOpen(false);

  return (
    <>
      <Box padding="2rem" textAlign="center">
        <Typography variant="subtitle1" gutterBottom>
          ã¾ã ç™»éŒ²ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
        </Typography>
        <Button
          className={classes.button}
          onClick={handleOpen}
          variant="contained"
          color="primary"
          >
          ã‚¿ã‚¹ã‚¯ã‚’ç™»éŒ²ã™ã‚‹
        </Button>
      </Box>
      <RegisterDialog open={open} onClose={handleClose} />
    </>
  );
}
```

22è¡Œç›®ã¨37è¡Œç›®ã®`<></>`ã§ã™ãŒã€

React ã§ã¯ return ã§è¿”ã™ JSX ã¯ã²ã¨ã¤ã®ã‚¿ã‚°ã§å…¨ä½“ãŒå›²ã¾ã‚Œã¦ã„ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

ãã“ã§ä¸å®šã®ã‚¿ã‚°ã§å…¨ä½“ã‚’å›²ã£ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã¯åˆ¥ã«`div`ã¨ã‹ã§ã‚‚ã„ã„ã®ã§ã™ãŒã€

HTML ã«ç¾ã‚Œãªã„`<></>`ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

{{< video src=dialog-appear opt=1 >}}

ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼

### ã‚¿ã‚¹ã‚¯ç™»éŒ²ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å…¥åŠ›éƒ¨åˆ†

å…¥åŠ›ã•ã›ã‚‹æƒ…å ±ã¯ã€

- å†…å®¹
- æœŸé™
- å„ªå…ˆåº¦

ã®ï¼“ã¤ã§ã™ã€‚

å†…å®¹ã¯ãƒ†ã‚­ã‚¹ãƒˆã€æœŸé™ã¯æ—¥ä»˜ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‰ã€å„ªå…ˆåº¦ã¯æ•°å€¤ã¨ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ä½¿ã„ã¾ã™ã€‚

ãƒ†ã‚­ã‚¹ãƒˆéƒ¨åˆ†ã¯ [Text Field](https://material-ui.com/components/text-fields/)ã€æœŸé™ã¯ [Pickers](https://material-ui-pickers.dev/)ã€

ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¯ Slider ã® [Label always visible](https://material-ui.com/components/slider/#label-always-visible) ã¨ [Slider with input field](https://material-ui.com/components/slider/#slider-with-input-field) ã‚’ä½¿ã£ã¦ã€

ã“ã‚Œã‚‰ã‚’ [Grid](https://material-ui.com/components/grid/) ã§ä¸¦ã¹ã¦ã„ã¾ã™ã€‚

<br/>

é•·ããªã£ãŸã®ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦åˆ†ã‘ã¾ã—ãŸã€‚

<br/>

å…¥åŠ›ã—ãŸæƒ…å ±ã¯ state ã¨ã—ã¦ç®¡ç†ä¸‹ã«ãŠããŸã„ã®ã§ã€atom ã®è¨­å®šã‚’ã—ã¾ã™ã€‚

```jsx {name="/src/atoms/RegisterDialogContent.tsx"}
import { atom } from 'recoil';

export const taskContentState = atom<string>({
  key: 'taskContentState',
  default: ''
});

export const taskDeadlineState = atom<Date>({
  key: 'taskDeadlineState',
  default: new Date()
});

export const taskPriorityState = atom<number>({
  key: 'taskPriorityState',
  default: 1
});
```

ã“ã‚Œã‚‰ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§å‘¼ã³å‡ºã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚

```jsx {name="/src/components/RegisterDialogContent.tsx"}
import React from 'react';
import { useRecoilState, useSetRecoilState } from 'recoil';

import Grid from '@material-ui/core/Grid';
import TextField from '@material-ui/core/TextField';
import Slider from '@material-ui/core/Slider';
import Input from '@material-ui/core/Input';
import DialogContent from '@material-ui/core/DialogContent';
import DialogContentText from '@material-ui/core/DialogContentText';
import DateFnsUtils from '@date-io/date-fns';
import {
  MuiPickersUtilsProvider,
  KeyboardDatePicker
} from '@material-ui/pickers';

import {
  taskContentState,
  taskDeadlineState,
  taskPriorityState
} from '../atoms/RegisterDialogContent';

export default function RegisterDialogContent() {
  // atom ã‹ã‚‰ state ã‚’å–å¾—ã™ã‚‹
  const setContent = useSetRecoilState(taskContentState);
  const [deadline, setDeadline] = useRecoilState(taskDeadlineState);
  const [priority, setPriority] = useRecoilState(taskPriorityState);

  // ã‚¿ã‚¹ã‚¯ã®å†…å®¹ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ã
  const handleContentChange = (
    e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>
  ) => {
    setContent(e.target.value);
  };

  // ã‚¿ã‚¹ã‚¯ã®æœŸé™ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ã
  const handleDeadlineChange = (date: any) => {
    setDeadline(date);
  };

  // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãŒå‹•ã‹ã•ã‚ŒãŸã¨ã
  const handleSliderChange = (e: React.ChangeEvent<{}>, newValue: any) => {
    setPriority(newValue);
  };

  // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼æ¨ªã®æ•°å€¤å…¥åŠ›æ¬„ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ã
  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setPriority(Number(e.target.value));
  };

  // æ•°å€¤å…¥åŠ›æ¬„ã§ï¼‘ï½ï¼•ä»¥å¤–ã®æ•°å€¤ãŒæŒ‡å®šã•ã‚ŒãŸã¨ã
  const handleBlur = () => {
    if (priority < 1) {
      setPriority(1);
    } else if (priority > 5) {
      setPriority(5);
    }
  };

  return (
    {// ã“ã®ã‚¿ã‚°å†…ã«ã‚ã‚‹éƒ¨åˆ†ãŒ pickers ã®ã‚«ãƒãƒ¼ã™ã‚‹ç¯„å›²ã«ãªã‚‹ }
    <MuiPickersUtilsProvider utils={DateFnsUtils}>
      <DialogContent>
        <DialogContentText>
          ç™»éŒ²ã™ã‚‹ã‚¿ã‚¹ã‚¯ã®æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
        </DialogContentText>
        <Grid container spacing={6} direction="column">
          <Grid item>
            <TextField
              onChange={handleContentChange}
              margin="dense"
              id="name"
              label="å†…å®¹"
              fullWidth   {// æ¨ªå¹…ã„ã£ã±ã„ã«ã™ã‚‹ }
            />
            <KeyboardDatePicker
              disableToolbar
              variant="inline"          {// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒå‡ºç¾ã™ã‚‹ä½ç½® }
              format="yyyy/MM/dd"       {// è¡¨ç¤ºã™ã‚‹æ—¥ä»˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ }
              minDate={new Date()}      {// ç¾åœ¨ã®æ—¥ã‚ˆã‚Šå‰ã®æ—¥ã¯é¸æŠä¸å¯ }
              margin="normal"
              id="date-picker-inline"
              label="æœŸé™"
              value={deadline}
              onChange={date => handleDeadlineChange(date)}
              invalidDateMessage="ç„¡åŠ¹ãªå½¢å¼ã§ã™"
              minDateMessage="æ˜¨æ—¥ä»¥å‰ã®æ—¥ä»˜ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“"
            />
          </Grid>
          <Grid container item spacing={2}>
            <Grid item xs={2}>
              <DialogContentText>å„ªå…ˆåº¦</DialogContentText>
            </Grid>
            <Grid item xs={8}>
              <Slider
                value={priority}
                onChange={handleSliderChange}
                defaultValue={1}        {// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ }
                aria-valuetext=""
                aria-labelledby="discrete-slider"
                valueLabelDisplay="on"  {// æ•°å­—ã®å¹ãå‡ºã—ã‚’å¸¸ã«è¡¨ç¤ºã™ã‚‹ }
                step={1}  {// å¤‰å‹•å¹… }
                marks     {// å¢ƒç•Œã«å°ã‚’ã¤ã‘ã‚‹ }
                min={1}   {// æœ€å°å€¤ }
                max={5}   {// æœ€å¤§å€¤ }
              />
            </Grid>
            <Grid item xs={2}>
              <Input
                value={priority}
                margin="dense"
                onChange={handleInputChange}
                onBlur={handleBlur}
                inputProps={{
                  step: 1,
                  min: 1,
                  max: 5,
                  type: 'number',
                  'aria-labelledby': 'input-slider'
                }}
              />
            </Grid>
          </Grid>
        </Grid>
      </DialogContent>
    </MuiPickersUtilsProvider>
  );
}
```

ã“ã‚Œã‚’è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`RegisterDialog.tsx`ã§å‘¼ã³å‡ºã—ã¾ã™ã€‚

```jsx {name="/src/components/RegisterDialog.tsx", hl_lines=[16]}
...

import RegisterDialogContent from './RegisterDialogContent';

...

export default function RegisterDialog({ open, onClose }: Props) {
  return (
    <Dialog
      open={open}
      onClose={onClose}
      aria-labelledby="form-dialog-title"
      fullWidth
    >
      <DialogTitle>ã‚¿ã‚¹ã‚¯ç™»éŒ²</DialogTitle>
      <RegisterDialogContent />
      <DialogActions>
        <Button onClick={onClose} color="primary">
          ã‚‚ã©ã‚‹
        </Button>
        <Button color="primary">ç™»éŒ²</Button>
      </DialogActions>
    </Dialog>
  );
}
```

ã¾ãŸã€Recoil ã‚’ä½¿ã£ãŸã®ã§ã€

ä½¿ç”¨ç¯„å›²ã«å«ã‚ã‚‹æœ€ä¸Šéšå±¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® JSX ã‚’`RecoilRoot`ã‚¿ã‚°ã§å›²ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```jsx {name="/src/App.tsx", hl_lines=[2, 11, 16]}
import React from 'react';
import { RecoilRoot } from 'recoil';

import TodoAppBar from './components/TodoAppBar';
import TodoList from './components/TodoList';

import './styles.css';

export default function App() {
  return (
    <RecoilRoot>
      <div className="App">
        <TodoAppBar />
        <TodoList />
      </div>
    </RecoilRoot>
  );
}
```

{{< video src=dialog-content opt=1 >}}

ã§ãã¾ã—ãŸï¼

### ã‚¿ã‚¹ã‚¯ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã¨ãã®ç”»é¢

ã¾ãšã€ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’ atom ã§è¨­å®šã—ã¾ã™ã€‚

```jsx {name="/src/atoms/Tasks.tsx"}
import { atom } from 'recoil';

export const tasksState = atom<
  { content: string; deadline: any; priority: number }[]
>({
  key: 'tasksState',
  default: []
});
```

ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«ã€atom ã«å€¤ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```jsx {name="/src/components/RegisterDialog.tsx", hl_lines=["17-31", 46], inline_hl=[15:["2-6"]]}
...
import { useRecoilValue, useRecoilState } from 'recoil';

...

import {
  taskContentState,
  taskDeadlineState,
  taskPriorityState
} from '../atoms/RegisterDialogContent';

import { tasksState } from '../atoms/Tasks';

...

export default function RegisterDialog({ open, onClose }: Props) {
  const taskContent = useRecoilValue(taskContentState);
  const taskDeadline = useRecoilValue(taskDeadlineState);
  const taskPriority = useRecoilValue(taskPriorityState);
  const [tasks, setTasks] = useRecoilState(tasksState);

  const handleRegister = () => {
    setTasks([
      ...tasks,
      {
        content: taskContent,
        deadline: taskDeadline,
        priority: taskPriority
      }
    ]);
    onClose();
  };

  return (
    <Dialog
      open={open}
      onClose={onClose}
      aria-labelledby="form-dialog-title"
      fullWidth
    >
      <DialogTitle>ã‚¿ã‚¹ã‚¯ç™»éŒ²</DialogTitle>
      <RegisterDialogContent />
      <DialogActions>
        <Button onClick={onClose} color="primary">
          ã‚‚ã©ã‚‹
        </Button>
        <Button onClick={handleRegister} color="primary">
          ç™»éŒ²
        </Button>
      </DialogActions>
    </Dialog>
  );
}
```

`tasks`ã«ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚

ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹ã®ã§ã€`handleRegister`é–¢æ•°ã®ä¸­ã«ã‚‚`onClose()`ã‚’æ›¸ã„ã¦ã„ã¾ã™ã€‚

<br/>

ç¶šã„ã¦ã‚¿ã‚¹ã‚¯ã®ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹è¡¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```jsx {name="/src/components/TodoTable.tsx"}
import React from 'react';
import { useRecoilState } from 'recoil';

import Table from '@material-ui/core/Table';
import TableHead from '@material-ui/core/TableHead';
import TableBody from '@material-ui/core/TableBody';
import TableCell from '@material-ui/core/TableCell';
import TableContainer from '@material-ui/core/TableContainer';
import TableRow from '@material-ui/core/TableRow';
import { format } from 'date-fns';

import { tasksState } from '../atoms/Tasks';

export default function TodoTable() {
  const [tasks, setTasks] = useRecoilState(tasksState);

  return (
    <TableContainer>
      <Table>
        <TableHead>
          <TableRow>
            <TableCell>ã‚¿ã‚¹ã‚¯</TableCell>
            <TableCell align="center">æœŸæ—¥</TableCell>
            <TableCell align="center">å„ªå…ˆåº¦</TableCell>
          </TableRow>
        </TableHead>
        <TableBody>
          {tasks.map((task: any) => (
            <TableRow>
              <TableCell>{task.content}</TableCell>
              <TableCell align="center">
                {// å¹´/æœˆ/æ—¥ã®å½¢å¼ã«å¤‰æ›ã—ã¦è¡¨ç¤ºã™ã‚‹ }
                {format(task.deadline, 'yyyy/MM/dd')}
              </TableCell>
              <TableCell align="center">{task.priority}</TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </TableContainer>
  );
}
```

ç™»éŒ²ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ãŒã²ã¨ã¤ã§ã‚‚ã‚ã‚Œã°ã€ã“ã®è¡¨ã‚’å‡ºç¾ã•ã›ã¾ã™ã€‚

ã‚¿ã‚¹ã‚¯ã®ä¸€è¦§ã‚’ [Table](https://material-ui.com/components/tables) ã‚’ä½¿ã£ã¦è¡¨ç¤ºã—ã€

ã‚¿ã‚¹ã‚¯è¿½åŠ ã®ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ã‚’ [Floating Action Button](https://material-ui.com/components/floating-action-button/#floating-action-button-2) ã‚’ä½¿ã£ã¦ç½®ã„ã¦ã„ã¾ã™ã€‚

```jsx {name="/src/components/TodoList.tsx", hl_lines=["21-28", 35, "45-57", 71]}
import { useRecoilValue } from 'recoil';

...

import Fab from '@material-ui/core/Fab';
import AddIcon from '@material-ui/icons/Add';

...

import TodoTable from './TodoTable';

import { tasksState } from '../atoms/Tasks';

const useStyles = makeStyles((theme: Theme) =>
  createStyles({
    button: {
      '&:hover': {
        backgroundColor: '#6666ff'
      }
    },
    fab: {
      position: 'absolute',
      bottom: '2rem',
      right: '2rem',
      '&:hover': {
        backgroundColor: '#6666ff'
      }
    }
  })
);

export default function TodoList() {
  const classes = useStyles();

  const tasks = useRecoilValue(tasksState);
  const [open, setOpen] = useState<boolean>(false);

  const handleOpen = () => setOpen(true);

  const handleClose = () => setOpen(false);

  return (
    <>
      <Box padding="2rem" textAlign="center">
        {tasks.length !== 0 ? (
          <>
            <TodoTable />
            <Fab
              className={classes.fab}
              onClick={handleOpen}
              color="primary"
              aria-label="add"
            >
              <AddIcon />
            </Fab>
          </>
        ) : (
          <>
            <Typography variant="subtitle1" gutterBottom>
              ã¾ã ç™»éŒ²ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
            </Typography>
            <Button
              className={classes.button}
              onClick={handleOpen}
              variant="contained"
              color="primary"
            >
              ã‚¿ã‚¹ã‚¯ã‚’ç™»éŒ²ã™ã‚‹
            </Button>
          </>
        )}
      </Box>
      <RegisterDialog open={open} onClose={handleClose} />
    </>
  );
}
```

ä¸‰é …æ¼”ç®—å­ã‚’ä½¿ç”¨ã—ã¦ã€`tasks`ã®è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã§æ¡ä»¶åˆ†å²ã‚’ã—ã¦ã„ã¾ã™ã€‚

{{< video src=task-table opt=1 >}}

### ã‚¿ã‚¹ã‚¯ã®å‰Šé™¤

é¸æŠã—ãŸã‚¿ã‚¹ã‚¯ãŒå‰Šé™¤ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

é¸æŠã«ã¯ [Checkbox](https://material-ui.com/components/checkboxes/) ã‚’ä½¿ã„ã¾ã™ã€‚

Table ã® [Sorting & Selecting](https://material-ui.com/components/tables/#sorting-amp-selecting) ã‚’å‚è€ƒã«ã—ã¾ã™ã€‚

```jsx {name="/src/components/TodoTable.tsx", hl_lines=["10-49", "52-59", "64-69", "78-83", 94]}
import React, { useState } from 'react';
...
import IconButton from '@material-ui/core/IconButton';
import DeleteIcon from '@material-ui/icons/Delete';
import Checkbox from '@material-ui/core/Checkbox';
...

export default function TodoTable() {
  const [tasks, setTasks] = useRecoilState(tasksState);
  const [selected, setSelected] = useState<number[]>([]);

  // ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’é¸æŠã™ã‚‹
  const handleSelectAll = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.checked) {
      setSelected([...Array(tasks.length).keys()]);
      return;
    }
    setSelected([]);
  };

  // ç‰¹å®šã®ã‚¿ã‚¹ã‚¯ã‚’é¸æŠã™ã‚‹
  const handleCheck = (e: React.ChangeEvent<HTMLInputElement>, i: number) => {
    const selectedIndex = selected.indexOf(i);
    let newSelected: number[] = [];

    if (selectedIndex === -1) {
      newSelected = newSelected.concat(selected, i);
    } else if (selectedIndex === 0) {
      newSelected = newSelected.concat(selected.slice(1));
    } else if (selectedIndex === selected.length - 1) {
      newSelected = newSelected.concat(selected.slice(0, -1));
    } else if (selectedIndex > 0) {
      newSelected = newSelected.concat(
        selected.slice(0, selectedIndex),
        selected.slice(selectedIndex + 1)
      );
    }

    setSelected(newSelected);
  };

  // é¸æŠã—ãŸã‚¿ã‚¹ã‚¯ã‚’æ¶ˆå»ã™ã‚‹
  const handleDelete = () => {
    let newTasks = tasks.filter(
      (e: object, i: number) => selected.indexOf(i) === -1
    );
    setTasks(newTasks);
    setSelected([]);
  };

  return (
    <>
      <IconButton
        onClick={handleDelete}
        disabled={selected.length === 0}
        aria-label="delete"
      >
        <DeleteIcon />
      </IconButton>
      <TableContainer>
        <Table>
          <TableHead>
            <TableRow>
              <TableCell padding="checkbox">
                <Checkbox
                  checked={tasks.length > 0 && tasks.length === selected.length}
                  onChange={handleSelectAll}
                />
              </TableCell>
              <TableCell>ã‚¿ã‚¹ã‚¯</TableCell>
              <TableCell align="center">æœŸæ—¥</TableCell>
              <TableCell align="center">å„ªå…ˆåº¦</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {tasks.map((task: any, index: number) => (
              <TableRow>
                <TableCell padding="checkbox">
                  <Checkbox
                    checked={selected.indexOf(index) !== -1}
                    onChange={(e: any) => handleCheck(e, index)}
                  />
                </TableCell>
                <TableCell>{task.content}</TableCell>
                <TableCell align="center">
                  {format(task.deadline, 'yyyy/MM/dd')}
                </TableCell>
                <TableCell align="center">{task.priority}</TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </TableContainer>
    </>
  );
}
```

{{< video src=table-delete opt=1 >}}

### ã‚¿ã‚¹ã‚¯ã®ä¸¦ã³æ›¿ãˆ

æœŸé™ã‚„å„ªå…ˆåº¦é †ã«ä¸¦ã³æ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

`tasks`ã®è¦ç´ ã¨ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã€ãã®`deadline`ã‚„`priority`ã«ã‚ˆã£ã¦ä¸¦ã³æ›¿ãˆã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

```jsx {name="/src/components/TodoTable.tsx", hl_lines=["20-31", "46-63"]}
...
import TableSortLabel from '@material-ui/core/TableSortLabel';
...

const sortTasks = (
  arr: { content: string; deadline: any; priority: number }[],
  sortBy: 'deadline' | 'priority',
  order: 'asc' | 'desc'
) =>
  arr.sort(
    (
      a: { content: string; deadline: any; priority: number },
      b: { content: string; deadline: any; priority: number }
    ) => (order === 'asc' ? a[sortBy] - b[sortBy] : b[sortBy] - a[sortBy])
  );

export default function TodoTable() {
  const [tasks, setTasks] = useRecoilState(tasksState);
  const [selected, setSelected] = useState<number[]>([]);
  const [order, setOrder] = useState<'asc' | 'desc'>('asc');
  const [orderBy, setOrderBy] = useState<'deadline' | 'priority' | ''>('');

  const handleSort = (sortBy: 'deadline' | 'priority') => (
    e: React.MouseEvent
  ) => {
    let newOrder: 'asc' | 'desc' =
      orderBy === sortBy ? (order === 'asc' ? 'desc' : 'asc') : 'asc';
    setOrderBy(sortBy);
    setOrder(newOrder);
    setTasks(sortTasks(tasks.concat(), sortBy, newOrder));
  };

  ...

  return (
    ...
          <TableHead>
            <TableRow>
              <TableCell padding="checkbox">
                <Checkbox
                  checked={tasks.length > 0 && tasks.length === selected.length}
                  onChange={handleSelectAll}
                />
              </TableCell>
              <TableCell>ã‚¿ã‚¹ã‚¯</TableCell>
              <TableCell align="center">
                <TableSortLabel
                  active={orderBy === 'deadline'}
                  direction={order === 'asc' ? 'desc' : 'asc'}
                  onClick={handleSort('deadline')}
                >
                  æœŸæ—¥
                </TableSortLabel>
              </TableCell>
              <TableCell align="center">
                <TableSortLabel
                  active={orderBy === 'priority'}
                  direction={order === 'asc' ? 'desc' : 'asc'}
                  onClick={handleSort('priority')}
                >
                  å„ªå…ˆåº¦
                </TableSortLabel>
              </TableCell>
            </TableRow>
          </TableHead>
    ...
  );
```

`sort`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€é…åˆ—ã‚’å¼•æ•°ã®é–¢æ•°ã«å¾“ã£ã¦ä¸¦ã³å¤‰ãˆã‚‹{{% tltp ç ´å£Šçš„ãƒ¡ã‚½ãƒƒãƒ‰ %}}æ“ä½œå¯¾è±¡ã‚’å¤‰æ›´ã™ã‚‹{{% /tltp %}}ã§ã™ã€‚

è¦ç´ ã¨ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®`deadline`ã¾ãŸã¯`priority`ã«ã‚‚ã¨ã¥ã„ã¦ã€

æ­£é †ã¾ãŸã¯é€†é †ã«ä¸¦ã¹æ›¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

<br/>

30è¡Œç›®ã®`tasks.concat()`ã¯ã€`tasks`ã®ã‚³ãƒ”ãƒ¼ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚

`sort`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ç ´å£Šçš„å‡¦ç†ãªã®ã§ã€ã“ã®ã‚ˆã†ã«ã—ãªã„ã¨`tasks`è‡ªä½“ã‚’å¤‰æ›´ã—ã‚ˆã†ã¨ã—ã¦ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

<br/>

49, 58è¡Œç›®ã¯ã€çŸ¢å°ã®å‘ãã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

{{< video src=table-sort opt=1 >}}

---

é•·ããªã‚Šã¾ã—ãŸãŒã€React + Recoil + Material-UI + TypeScript ã§ã® ToDo ã‚¢ãƒ—ãƒªã®å®Ÿè£…ã«ã¤ã„ã¦æ›¸ãã¾ã—ãŸã€‚

Material-UI ã§æœ¬å½“ã«ã„ã‚ã„ã‚ãªã“ã¨ãŒæ¯”è¼ƒçš„ç°¡å˜ã«ã§ãã¦æ¥½ã—ã„ï¼ã¨ã„ã†ã®ã¨ã€

Recoil ãŒ React Hooks ã‹ã‚‰ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«ç§»è¡Œã§ãã¦å­¦ç¿’ã‚³ã‚¹ãƒˆã‚‚æ„å¤–ã¨ä½ã„ï¼ã¨ã„ã†å°è±¡ã§ã—ãŸã€‚

ã“ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

ã§ã¯ã¾ãŸğŸ‘‹
