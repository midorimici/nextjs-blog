---
title: "ãƒã‚§ã‚¹ã‚¢ãƒ—ãƒªé–‹ç™º(15) ã‚²ãƒ¼ãƒ ã®åˆ‡ã‚Šæ›¿ãˆ"
date: 2020-09-04T12:00:00+09:00
lastmod: 2020-09-26T12:00:00+09:00
categories: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, ãƒã‚§ã‚¹ã‚¢ãƒ—ãƒªé–‹ç™º]
tags: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, Python, ã‚¢ãƒ—ãƒªé–‹ç™º, ãƒã‚§ã‚¹]
draft: false
---

Python ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§å‹•ã‹ã™ãƒ•ã‚§ã‚¢ãƒªãƒ¼ãƒã‚§ã‚¹ã‚¢ãƒ—ãƒªé–‹ç™ºã€é€£è¼‰ç¬¬ 15 å›ã§ã™ã€‚

<pstlk label="å‰å›" to="chess-app-devel-14" />ã¯ãƒ•ã‚§ã‚¢ãƒªãƒ¼é§’ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

ä»Šå›ã¯ã•ã¾ã–ã¾ãªç¨®é¡ã®ãƒ•ã‚§ã‚¢ãƒªãƒ¼ãƒã‚§ã‚¹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã™ã€‚

<!--more-->

ç¾åœ¨ã®çŠ¶æ…‹ã§ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èµ·å‹•ã™ã‚‹ã¨ã™ãã«ç›¤é¢ãŒè¡¨ç¤ºã•ã‚Œã¦éŠã¹ã‚‹çŠ¶æ…‹ã«ãªã‚Šã¾ã™ãŒã€

ã“ã®å‰ã«ã„ã£ãŸã‚“ã‚²ãƒ¼ãƒ ç¨®é¡ã‚’é¸æŠã™ã‚‹ç”»é¢ã‚’å…¥ã‚Œã¾ã™ã€‚

<br/>

é¸æŠç”»é¢ã§ã¯ï¼•è¡Œï¼’åˆ—ã€ï¼‘ãƒšãƒ¼ã‚¸ã§10ç¨®é¡ã®ã‚²ãƒ¼ãƒ ã‚’ä¸¦ã¹ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

ç”»é¢ã§ç‰¹å®šã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€å¯¾å¿œã™ã‚‹ã‚²ãƒ¼ãƒ ã®ç›¤é¢ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã‚²ãƒ¼ãƒ ãŒã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ãã®ãŸã‚ã«ã¯ã€æŠ¼ã—ãŸãƒœã‚¿ãƒ³ã«ã‚ˆã£ã¦ã‚»ãƒƒãƒˆã™ã‚‹ç›¤é¢ã‚„é§’ã‚’å¤‰åŒ–ã•ã›ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

<br/>

## ã‚²ãƒ¼ãƒ ã‚’å®šç¾©ã™ã‚‹

ã‚²ãƒ¼ãƒ ã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹ã®ã¯ã€ç›¤é¢ã®ã‚µã‚¤ã‚ºã€ã‚­ãƒ£ã‚¹ãƒªãƒ³ã‚°ã®æœ‰ç„¡ã€ãƒãƒ¼ãƒ³ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã€

ã©ã®é§’ãŒã©ã“ã«ç½®ã‹ã‚Œã¦ã„ã‚‹ã®ã‹ã‚„ã€ç”»åƒIDã¨é§’ã®å¯¾å¿œã®æƒ…å ±ã§ã™ã€‚

<br/>

ã“ã‚Œã‚‰ã‚’å®šç¾©ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ã‚²ãƒ¼ãƒ ç¨®é¡ã”ã¨ã«ä½œæˆã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã®å®šç¾©ã‚’ã¾ã¨ã‚ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«`games.py`ã‚’ä½œæˆã—ã¾ã™ã€‚

```py {name="games.py"}
'''ã‚²ãƒ¼ãƒ ã®ç¨®é¡ã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹é§’ã®é…ç½®ã‚„åå‰ã€ç”»åƒIDã‚’è¨˜éŒ²ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«'''

from pieces import *


class Normal:
    '''é€šå¸¸ã®ãƒã‚§ã‚¹'''
    # ç›¤é¢ã®ã‚µã‚¤ã‚º
    size = 8
    # ã‚­ãƒ£ã‚¹ãƒªãƒ³ã‚°ã®æœ‰ç„¡
    castling = True
    # ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å…ˆ
    promote2 = [Knight, Bishop, Rook, Queen]
    # é§’ã®é…ç½®
    placers = {1: [Rook, Knight, Bishop, Queen, King, Bishop, Knight, Rook],
        2: [Pawn] * size}
    # ç”»åƒIDã®å‰²ã‚Šå½“ã¦
    ID = {}
    for rk in placers:
        for fl in range(size):
            if placers[rk][fl] is not None:
                ID['W' + placers[rk][fl].abbr] = size * rk + fl
                ID['B' + placers[rk][fl].abbr] = -(size * rk + fl)


class withUnicorn:
    '''ã‚­ãƒ³ã‚°ã‚µã‚¤ãƒ‰ã®ãƒŠã‚¤ãƒˆãŒãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³ã«ãªã£ãŸãƒã‚§ã‚¹'''
    # ç›¤é¢ã®ã‚µã‚¤ã‚º
    size = 8
    # ã‚­ãƒ£ã‚¹ãƒªãƒ³ã‚°ã®æœ‰ç„¡
    castling = True
    # ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å…ˆ
    promote2 = [Knight, Bishop, Rook, Queen, Unicorn]
    # é§’ã®é…ç½®
    placers = {1: [Rook, Knight, Bishop, Queen, King, Bishop, Unicorn, Rook],
        2: [Pawn] * size}
    # ç”»åƒIDã®å‰²ã‚Šå½“ã¦
    ID = {}
    for rk in placers:
        for fl in range(size):
            if placers[rk][fl] is not None:
                ID['W' + placers[rk][fl].abbr] = size * rk + fl
                ID['B' + placers[rk][fl].abbr] = -(size * rk + fl)
```

ã‚¯ãƒ©ã‚¹åã¯é§’ã‚¯ãƒ©ã‚¹åã¨ç•°ãªã‚‹ã“ã¨ã«æ³¨æ„ã—ã¾ã™ã€‚

ç”»åƒIDã«ã¯ã€å„ç¨®å„è‰²ã®é§’ã«ä¸€æ„çš„ã«æ•´æ•°ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚

<br/>

ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã‚’ã‚‚ã¨ã«ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€ãã®å±æ€§ã‚’å…ƒã«ç›¤é¢ã‚„é§’ã‚’è¨­ç½®ã—ã¾ã™ã€‚

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ã€ã‚²ãƒ¼ãƒ ã®ç¨®é¡ãŒæ±ºã¾ã£ãŸã¨ãï¼ç‰¹å®šã®ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã§ã™ãŒã€

ã²ã¨ã¾ãšã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä»£å…¥ã™ã‚‹å¤‰æ•°ã®å®£è¨€ã‚’ã—ã¦ãŠãã¾ã™ã€‚

```py {name="main.py", hl_lines=["5-7", "10-16", "19-35"], ins=["1-9", "19-26"], del=[0, "10-18"]}
class Game:
    def __init__(self):
        self.playersturn = W
        self.gameboard = {}
        self.place_pieces()
        # ã‚²ãƒ¼ãƒ ã®ç¨®é¡
        self.kind = None
        ...

    def after_deciding_kind(self):
        '''ã‚²ãƒ¼ãƒ ç¨®é¡æ±ºå®šå¾Œã®å‡¦ç†'''
        # é§’ã®é…ç½®
        self.place_pieces() 
        # ç”»åƒã®è¨­å®š
        for name, num in self.kind.ID.items():
            set_img(name, name[0], num)

    def place_pieces(self):
        for i in range(0, 8):
            self.gameboard[(i, 1)] = Pawn(W, 1)
            self.gameboard[(i, 6)] = Pawn(B, -1)
ã€€
        placers = [Rook, Knight, Bishop, Queen, King, Bishop, Unicorn, Rook]
ã€€
        for i in range(0, 8):
            self.gameboard[(i, 0)] = placers[i](W)
            self.gameboard[(i, 7)] = placers[i](B)
        for fl in range(self.kind.size):
            for rk in self.kind.placers:
                # None ã‚’æŒ‡å®šã™ã‚Œã°é§’ãŒç½®ã‹ã‚Œã‚‹ã“ã¨ã¯ãªãæ¬¡ã®ãƒã‚¹ã¸é€²ã‚€
                if self.kind.placers[rk][fl] is not None:
                    # ç™½ã®é§’
                    self.gameboard[(fl, rk - 1)] = self.kind.placers[rk][fl]('W')
                    # é»’ã®é§’
                    self.gameboard[(fl, self.kind.size - rk)] = self.kind.placers[rk][fl]('B')
...
```

`after_deciding_kind`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å±æ€§ã‚’ã‚‚ã¨ã«é§’ã®é…ç½®ã¨ç”»åƒIDã®è¨­å®šã‚’ã—ã¦ã„ã¾ã™ã€‚

<br/>

`Pawn`ã‚¯ãƒ©ã‚¹ã§ã¯ç‹¬è‡ªã«ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¨­å®šã—ã¦ã„ã¾ã—ãŸãŒã€

è‰²ã«ã‚ˆã£ã¦é€²ã‚€æ–¹å‘ã¯æ˜ç™½ãªã®ã§ç‰¹åˆ¥ã«å®šç¾©ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```py {name="pieces.py", hl_lines=["6-11", 13], ins=[6], del=["0-5"]}
...

class Pawn(Piece):
    abbr = 'P'

    def __init__(self, color, direction):
        self.color = color
        # of course, the smallest piece is the hardest to code. direction should be either 1 or -1, should be -1 if the pawn is traveling "backwards"
        self.direction = direction
        self.name = color + self.abbr
ã€€
    def available_moves(self, x, y, gameboard):
        self.direction = 1 if self.color == 'W' else -1
        ...
```


<br/>

## ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹

ï¼•è¡Œï¼’åˆ—ã«ãƒœã‚¿ãƒ³ã‚’ä¸¦ã¹ã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚

```py {name="utils.py"}
...
def draw_button(left, right, bottom, top,
        letter, back_color=(1.00, 0.81, 0.62), font_color=(0.82, 0.55, 0.28)):
    '''ãƒœã‚¿ãƒ³ã‚’æç”»ã™ã‚‹

    Parameters
    ----------
    left, right, bottom, top : float
        ãƒœã‚¿ãƒ³ã®å·¦å³ä¸‹ä¸Šç«¯ã®åº§æ¨™ï¼
    letter : str
        ãƒœã‚¿ãƒ³ä¸Šã«æç”»ã™ã‚‹æ–‡å­—ï¼
    back_color : tuple or list, default (1.00, 0.81, 0.62)
        ãƒœã‚¿ãƒ³ã®è‰²ï¼
    font_color : tuple or list, default (0.82, 0.55, 0.28)
        æ–‡å­—ã®è‰²ï¼
    '''
    glColor(*back_color)
    glBegin(GL_QUADS)
    glVertex(left, bottom)
    glVertex(left, top)
    glVertex(right, top)
    glVertex(right, bottom)
    glEnd()
    glColor(*font_color)
    draw_str((left + right) / 2 - 0.1 * len(letter), (bottom + top) / 2, letter, gap=0.2)


# ã‚²ãƒ¼ãƒ é¸æŠç”»é¢ã«è¡¨ç¤ºã™ã‚‹ã‚²ãƒ¼ãƒ å
game_name_dict = {0: ('Normal Chess', 'Unicorn', 'A', 'B', 'C'),
    1: ('D', 'E', 'F')}


def draw_game_menu():
    '''ã‚²ãƒ¼ãƒ é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æç”»ã™ã‚‹'''
    for i in range(2):
        for j in range(5):
            if i in game_name_dict and j < len(game_name_dict[i]):
                draw_button(4.5*i - 0.5, 4.5*i + 3.0, 6.5 - 1.5*j, 7.5 - 1.5*j,
                    game_name_dict[i][j])
...
```

25è¡Œç›®ã®`0.1`ã‚„ `0.2`ã¨ã„ã†æ•°å€¤ã¯è¦‹ãˆæ–¹ã«ã‚ˆã£ã¦èª¿æ•´ã—ã¾ã™ã€‚

ã“ã‚Œã‚’æç”»ã‚¤ãƒ™ãƒ³ãƒˆå†…éƒ¨ã§ä½¿ç”¨ã—ã¾ã™ã€‚

```py {name="main.py", hl_lines=["8-10"]}
from utils import *
...

class Game:
    ...
    def draw(self):
        ...
        if self.kind == None:
            draw_game_menu()
        else:
            if self.time == 1:
                self.main()
            ...
        ...
```

ã“ã‚Œã§ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

{{< img src=game_buttons width=360 alt="ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³" >}}

<br/>

## ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã«å¯¾å¿œã™ã‚‹

ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«ã€æŒ‡å®šã®ã‚²ãƒ¼ãƒ ç¨®é¡ã‚’å†…éƒ¨ã§ç™»éŒ²ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã¾ãšã€è¡¨ç¤ºä½ç½®ã«å¯¾å¿œã™ã‚‹ã‚²ãƒ¼ãƒ ã‚¯ãƒ©ã‚¹ã‚’æ ¼ç´ã™ã‚‹ãƒ‡ã‚£ã‚¯ã‚·ãƒ§ãƒŠãƒªã‚’å®šç¾©ã—ã¾ã™ã€‚

```py {name="games.py"}
...
# ã‚²ãƒ¼ãƒ é¸æŠç”»é¢ã«è¡¨ç¤ºã™ã‚‹ã‚²ãƒ¼ãƒ 
game_dict = {0: (Normal, withUnicorn)}
```

è¡¨ç¤ºç”¨ã«ä½¿ã£ãŸ`A B C ...`ã¯ã‚¯ãƒ©ã‚¹ã‚’ä½œã£ã¦ã„ãªã„ã®ã§çœã„ã¦ã„ã¾ã™ã€‚

<br/>

ã“ã‚Œã‚’ä½¿ã£ã¦ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚

```py {name="main.py", hl_lines=[2, "13-21"]}
...
from games import *
...

class Game:
    ...
    def mouse(self, button, state, x, y):
        ...
        # å·¦ã‚¯ãƒªãƒƒã‚¯
        if (button == GLUT_LEFT_BUTTON
                and state == GLUT_DOWN):
            try:
                # ã‚²ãƒ¼ãƒ ç¨®é¡é¸æŠ
                if self.kind == None:
                    for i in range(2):
                        for j in range(5):
                            if i in game_dict and j < len(game_dict[i]):
                                if on_square(*self.mousepos, 4.5*i - 0.5, 4.5*i + 3.0, 6.5 - 1.5*j, 7.5 - 1.5*j):
                                    self.kind = game_dict[i][j]()
                                    self.after_deciding_kind()
                else:
                    ...
    ...
```

ã“ã‚Œã§ã‚²ãƒ¼ãƒ ã®é¸æŠã‚’å®Ÿç¾ã§ãã¾ã—ãŸã€‚

ãƒœã‚¿ãƒ³ã‚’é¸æŠã™ã‚‹ã¨ç›¤é¢ã¨é§’ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

<br/>

ä»Šå›ã®å¤‰æ›´ã¯ [GitHub](https://github.com/midorimici/chess-program-for-python-and-OpenGL/releases/tag/v.1.5) ã«ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

---

åŸºæœ¬çš„ã«ã“ã‚Œã¾ã§è§£èª¬ã—ã¦ããŸã“ã¨ã‚’ä½¿ãˆã°ã€ãƒ•ã‚§ã‚¢ãƒªãƒ¼é§’ã®ä½œæˆã‚„ã‚²ãƒ¼ãƒ ç¨®é¡ã®æ‹¡å¼µã‚’ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã‚ã¨ã¯ç‰¹æ®ŠãªæŒ™å‹•ã®é§’ã‚’ã©ã†å®Ÿè£…ã™ã‚‹ã‹ã€ãªã©ã¨ã„ã£ãŸç´°ã‹ã„è©±ã«ãªã£ã¦ãã¾ã™ã€‚

ãŠèª­ã¿ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

ã§ã¯ã¾ãŸğŸ‘‹
