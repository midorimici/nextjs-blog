---
title: "ã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªé–‹ç™º(5) é§’ã®ç§»å‹•ãƒ»ã‚¿ãƒ¼ãƒ³äº¤ä»£"
date: 2020-12-31T12:00:00+09:00
lastmod: 2020-12-31T12:00:00+09:00
categories: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, ã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªé–‹ç™º]
tags: [ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°, Python, ã‚¢ãƒ—ãƒªé–‹ç™º]
draft: false
---

Python ã§ã¤ãã‚‹ã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ã€é€£è¼‰ç¬¬ 5 å›ã§ã™ã€‚

<pstlk label="å‰å›" to="geister-app-dev-4" />ã¯åˆæœŸç›¤é¢ã‚’ç”Ÿæˆã—ã¦æç”»ã—ã¾ã—ãŸã€‚

ä»Šå›ã¯é§’ã®ç§»å‹•ã¨ã‚¿ãƒ¼ãƒ³äº¤ä»£ã®ç”»é¢ã‚’ç”¨æ„ã—ã¾ã™ã€‚

<!--more-->

ã‚¬ã‚¤ã‚¹ã‚¿ãƒ¼ã§ã¯ç›¸æ‰‹ã®é§’ãŒè¦‹ãˆã¦ã¯ã„ã‘ãªã„ã®ã§ã€

ã‚¿ãƒ¼ãƒ³äº¤ä»£ã®ãŸã³ã«å¼•ç¶™ãã®ãŸã‚ã®ç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

<br/>

## é§’ã®ç§»å‹•

é§’ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«è¡Œå…ˆã‚’è¡¨ç¤ºã—ã€ãã‚Œã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãã®å ´æ‰€ã«ç§»å‹•ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã¾ãšã¯è¡Œå…ˆã‚’è¡¨ã™å††ã‚’æç”»ã—ã¾ã™ã€‚

```py {name="draw.py"}
...
def dest(screen, pos, board):
    '''
    é§’ã®è¡Œå…ˆã‚’å††ã§è¡¨ç¤ºã™ã‚‹

    screen : pygame.display.set_mode
    pos : tuple <- (int, int)
        é§’ã®ä½ç½®
    board : dict <- {(int, int): Piece}
        é§’ã®ä½ç½®ã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    '''
    for _pos in board[pos].covering_squares(pos):
        # è‡ªåˆ†ã®é§’ã‚’é™¤å¤–
        if not (tuple(_pos) in board and board[tuple(_pos)].side == board[pos].side):
            _coord = np.asarray(_pos)*SQUARE_SIZE + MARGIN + SQUARE_SIZE/2
            pygame.draw.circle(screen, LAWNGREEN, [int(c) for c in _coord], int(PIECE_SIZE/2))
...
```

`LAWNGREEN`ã¯è‰²ã®å®šæ•°ã§ã€å®šæ•°ã‚’ã¾ã¨ã‚ã¦ã‚ã‚‹åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å®šç¾©ã—ã¦ã‚ã‚Šã¾ã™ã€‚

`pygame.draw.circle`ã®å¼•æ•°ã«ã¯ä¸­å¿ƒã®åº§æ¨™ã¨åŠå¾„ã‚’æŒ‡å®šã—ã¾ã™ã€‚

<br/>

ã“ã‚Œã‚’ã€é§’ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«è¡¨ç¤ºã—ã¾ã™ã€‚

```py {name="main.py", hl_lines=["2-9", "15-18", "30-44"], inline_hl=[0:["5-8"], 8:[8]]}
...
def main(screen, font, font_small, orders, move_snd):
    # ãƒœãƒ¼ãƒ‰æç”»ã«æ¸¡ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    # 0 - å…ˆæ”», 1 - å¾Œæ”», 2 - çµ‚äº†å¾Œ
    _turn = 0
    # ãƒã‚¦ã‚¹é¸æŠä¸­ã®é§’ã®ä½ç½®
    _selecting_pos = None
    # å‹•ã‹ã—çµ‚ã‚ã£ãŸ
    _move_finished = False
    ...

    while True:
        screen.fill(IVORY)
        # ç›¤é¢
        draw.board(screen, _board, _turn)
        if _selecting_pos is not None:
            # è¡Œå…ˆ
            draw.dest(screen, _selecting_pos, _board)
        pygame.display.update()

        # ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        for event in pygame.event.get():
            ...
            # ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯
            if event.type == MOUSEBUTTONDOWN:
                # å·¦
                if event.button == 1:
                    _mouse_pos = event.pos
                    _square_pos = tuple(mouse.chcoord(_mouse_pos))
                    if _move_finished: continue
                    if _square_pos in _board and _board[_square_pos].side == _turn:
                        # é§’ã‚’é¸æŠã—ãŸã¨ã
                        _selecting_pos = _square_pos
                    else:
                        # è¡Œå…ˆã‚’é¸æŠã—ãŸã¨ã
                        if (_selecting_pos in _board
                                and _square_pos in _board[_selecting_pos].covering_squares(_selecting_pos)):
                            # é§’ã®ç§»å‹•
                            move_snd.play()
                            _board[_square_pos] = _board[_selecting_pos]
                            del _board[_selecting_pos]
                            # ç§»å‹•å®Œäº†
                            _move_finished = True
                        _selecting_pos = None
            ...
```

{{< video src=move opt=1 >}}

<br/>

## ã‚¿ãƒ¼ãƒ³äº¤ä»£

æ¬¡ã«ã‚¿ãƒ¼ãƒ³äº¤ä»£ã®ç”»é¢ã‚’ç”¨æ„ã—ã¾ã™ã€‚

ã¾ãšã¯å¼•ç¶™ãç”»é¢ã‚’æç”»ã™ã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚

```py {name="draw.py"}
...
def confirmation(screen, font, font_small, turn):
    '''
    æ‰‹ç•ªäº¤ä»£ã®ç¢ºèªç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹

    screen : pygame.display.set_mode
    font, font_small : pygame.font.SysFont
        ãƒ•ã‚©ãƒ³ãƒˆ
    turn : int <- 0 | 1
        0 - æ¬¡ã¯å…ˆæ”», 1 - æ¬¡ã¯å¾Œæ”»
    '''
    assert turn == 0 or turn == 1, 'draw.confirmation ã®å¼•æ•° turn ã¯ 0, 1 ã®å€¤ã‚’å–ã‚Šã¾ã™'
    screen.fill(WHITE, (*MARGIN, 6*SQUARE_SIZE, 6*SQUARE_SIZE))
    _str1 = ('å…ˆ' if turn == 0 else 'å¾Œ') + 'æ”»ã®ã‚¿ãƒ¼ãƒ³ã ã‚ˆ'
    _str2 = 'ç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã­'
    _str3 = 'å‹•ã‹ã—çµ‚ã‚ã£ãŸã‚‰ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã­'
    _text1 = font.render(_str1, True, BLACK)
    _text2 = font.render(_str2, True, BLACK)
    _text3 = font_small.render(_str3, True, BLACK)
    screen.blit(_text1, DISP_SIZE/2-(len(_str1)*32/2, 32))
    screen.blit(_text2, DISP_SIZE/2-(len(_str2)*32/2, -32))
    screen.blit(_text3, DISP_SIZE/2-(len(_str3)*16/2, -32*4))
...
```

ç›¤é¢ã‚’ç™½ã„çŸ©å½¢ã§è¦†ã„éš ã—ã€ãã®ä¸Šã«ãƒ†ã‚­ã‚¹ãƒˆã‚’æã„ã¦ã„ã¾ã™ã€‚

ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯é§’ã‚’å‹•ã‹ã—çµ‚ã‚ã£ãŸã‚‰ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã“ã®ç”»é¢ã‚’è¡¨ç¤ºã—ã€

ã‚‚ã†ä¸€æ–¹ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«äº¤ä»£ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

```py {name="game.py", hl_lines=["6-8", "13-15", "27-30", "35-42"]}
...
def main(screen, font, font_small, orders, move_snd, chturn_snd):
    # ãƒœãƒ¼ãƒ‰æç”»ã«æ¸¡ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    # 0 - å…ˆæ”», 1 - å¾Œæ”», 2 - çµ‚äº†å¾Œ
    _turn = 0
    # æ¬¡ã®ç•ªã‚’ç¢ºèªã™ã‚‹ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ã¨ãã«æ¸¡ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    # 0 - å…ˆæ”», 1 - å¾Œæ”», 2 - ãªã—
    _next = 0
    ...

    while True:
        ...
        if _next == 0 or _next == 1:
            # äº¤ä»£ç¢ºèªç”»é¢
            draw.confirmation(screen, font, font_small, _next)
        ...

        # ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        for event in pygame.event.get():
            ...
            # ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯
            if event.type == MOUSEBUTTONDOWN:
                # å·¦
                if event.button == 1:
                    _mouse_pos = event.pos
                    _square_pos = tuple(mouse.chcoord(_mouse_pos))
                    # ç¢ºèªç”»é¢ã®ã‚¯ãƒªãƒƒã‚¯
                    if _next == 0 or _next == 1:
                        _next = 2
                        continue
                    ...
            # ã‚­ãƒ¼
            if event.type == KEYDOWN:
                ...
                # Space ã‚­ãƒ¼
                if event.key == K_SPACE:
                    if _move_finished:
                        # ã‚¿ãƒ¼ãƒ³äº¤ä»£
                        chturn_snd.play()
                        _turn = (_turn+1)%2
                        _next = _turn
                        _move_finished = False
                ...
```

ã‚²ãƒ¼ãƒ é–‹å§‹ç›´å¾Œã‚‚ç¢ºèªç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ã€`_next = 0`ã¨ã—ã¦ã„ã¾ã™ã€‚

{{< video src=chturn opt=1 >}}

---

<pstlk label="æ¬¡å›" to="geister-app-dev-6" />ã¯å‹åˆ©æ¡ä»¶ã‚’åˆ¤å®šã—ã¦ã€å‹è€…ã‚’è¡¨ç¤ºã™ã‚‹ã¨ã“ã‚ã¾ã§ã‚„ã‚ŠãŸã„ã¨æ€ã„ã¾ã™ã€‚

èª­ã‚“ã§ãã ã•ã£ã¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

ã§ã¯ğŸ‘‹
