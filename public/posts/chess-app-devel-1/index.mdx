---
title: "チェスアプリ開発(1) オリジナルのコードを解読"
date: 2020-02-09T18:17:00+09:00
lastmod: 2020-02-29T18:17:00+09:00
categories: [プログラミング, チェスアプリ開発]
tags: [プログラミング, Python, アプリ開発, チェス]
summary: "
チェスにはフェアリーチェスと言って、普通のルールのチェスとは異なるルールのものがあります。


また駒もフェアリーチェス独特の面白い駒があったりします。


でもそういうチェスができるアプリってなかなかないんですよね。


ということで、自分で作っちゃおう！ 
"
published: true
---

チェスにはフェアリーチェスと言って、普通のルールのチェスとは異なるルールのものがあります。

また駒もフェアリーチェス独特の面白い駒があったりします。

ちなみに将棋にも大局将棋とか天竺大将棋というものがあって、駒の動きとか調べてると本当にカオスだなって感じ。 

でもそういうチェスができるアプリってなかなかないんですよね。

あったとしても[チェス960](https://ja.wikipedia.org/wiki/%E3%83%81%E3%82%A7%E3%82%B9960)(ポーン以外の並び順がバラバラになるチェス)ぐらいで、変則駒を使えるものは見たことがありません。

ということで、 Python も覚えたし、自分で作っちゃおう！ 

<br/>

## まずは先例を調査

とは言っても、さすがにゼロから作るのは難しいので、 Python でチェスのプログラムを作った人がいないか、調べてみました。

すると、なんといるではありませんか！ 

→ [chess program for python][prog]

[prog]: https://gist.github.com/rsheldiii/2993225

おお、ありがたい！これをベースにさせていただいて、プログラムを書いていきましょう。 

### とりあえず動かしてみる

どんな感じになってるのか、とりあえず動かして遊んでみます。

<postimage src="img1" alt="コマンドライン" />

おお、すごい！

って、あれ？黒のクイーンとキングの位置が逆になってるぞ？

まあ、とりあえず動かそう。 d2 を d4 に。

<postimage src="img2" alt="コマンドライン" />

黒先だと…？

ならば、 d7 を d5 に！

<postimage src="img3" alt="コマンドライン" />

１歩しか動けない…

ポーンは本来最初の１手だけは２歩進めるんですが…

まあ、とりあえず動いているところを見たい。

<postimage src="img4" alt="コマンドライン" />

おお、ちゃんと動いてる！わーい😄

（なんでこう書けば動かせると分かったかと言うと、単にソースコードを見たからです。）

でも、先ほどのリンクページの下にも書いてあったんですが、色々と問題点が残っているみたいで。

ちょうど[問題点をリストアップしてくれている人](https://gist.github.com/rsheldiii/2993225#gistcomment-2778846)もいますので、

次回からはそれらを修正しながら、プログラムがどのように動いているか見ていくことにします。

ここではとりあえずソースコードをのぞいてみましょう。

長いので、ここには貼りません。[リンク][prog]からコードを見てみてください。

### ソースコードを見てみる

コードは大きく二つのパートに分けられます。

[ゲームの進行を制御するパート](https://gist.github.com/rsheldiii/2993225#file-chess-py-L14)と、[駒の動きを定義するパート](https://gist.github.com/rsheldiii/2993225#file-chess-py-L132)です。

- **ゲームの進行制御**

    `Game`
    <tltp label="クラス">オブジェクトの型、設計図のようなもの</tltp>の内部に様々な<tltp label="メソッド">クラス内で定義される関数のようなもの</tltp>が入っていますね。

    `placePieces`で盤面に駒を配置し、

    `main`が全体の流れを制御しているようです。

    `isCheck`はキングがチェックされているかどうかを返し、

    `canSeeKing`が誰かがキングを攻撃しているかどうかを返します。

    `parseInput`はキーボード入力を受け付け、

    `printBoard`で盤面の絵をプリントしています。

- **駒の動きの定義**

    各駒のクラスと、それらの<tltp label="基底クラス">継承元のクラス<br/>親クラス</tltp>の`Piece`がメインです。

    各駒のクラスは共通して`availableMoves`メソッドを持ち、移動可能な位置を出力しています。

    ポーンはちょっとややこしそう。

    `Piece`では<tltp label="属性">オブジェクトが参照できるデータや処理</tltp>を付与し、各駒の`availableMoves`で使うためのメソッドが用意されています。

    ランナー（特定の方向に一直線に進む駒）をつくったり、味方駒は攻撃しないけど敵駒は攻撃できるようにしたり、などですね。

<br/>

`Game`の`placePieces`で、各駒のクラスをもとに駒をオブジェクトとして生成しています。

盤面は、駒の位置を表す二要素
<tltp label="タプル">多数のデータを格納する、要素が変更不可能な構造</tltp>
をキーに、駒オブジェクトを値にとった
<tltp label="辞書">キーと値が1対1に対応する形でまとめられた構造</tltp>
として表現されています。

なぜタプルかというと、タプルは<tltp label="イミュータブルimmutable">要素が変更不可能であること</tltp>なので、辞書のキーとして使えるから。

それと辞書のキーは重複指定不可能なので、盤面上のひとつのマスにはひとつの駒しか乗らないのをうまく利用しているようです。

---

機能を拡張するには、オリジナルをよく知ることが大切だと思っていますので、

<pstlk label="次回" to="chess-app-devel-2" />から、問題点を修正しつつ仕組みを理解していきます！
